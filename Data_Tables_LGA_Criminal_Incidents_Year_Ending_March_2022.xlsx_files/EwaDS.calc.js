(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[15],{1012:function(y,C,b){function a(P){this.calcManager=P}function c(){return x.call(this)||this}function e(){this.secondRow=this.firstRow=null;return this}function f(){return x.call(this)||this}function l(){this.right=this.left=this.bottom=this.top=null;return this}function n(){return x.call(this)||this}function m(){this.secondColumn=this.firstColumn=null;return this}function h(){var P=x.call(this)||this;P.khc=!1;return P}
function x(){this.end=this.start=0;this.rv=null}function u(){this.column=this.row=null;return this}function w(){}b.r(C);y=b(0);var v=b(7),t=b(15);Object(y.a)(w,"Reference",null,[]);Wl(u,w);Object(y.a)(u,"CellReference",w,[]);x.prototype.OJg=function(P,Q){for(var M=0;M<this.rv.length;M++){var ba=this.x_b(P,this.rv[M]);Q+=ba;M<this.rv.length-1&&(Q+=":")}return Q};Object(y.a)(x,"IReferenceSequence",null,[]);var z=b(25),D=b(998);Wl(h,x);h.prototype.tbc=function(){var P=b(1012).RelativeAndAbsoluteReferencesManager,
Q=this.rv[0];return P.Wqf(Q.row.kind===D.a.abs,Q.column.kind===D.a.abs)};h.prototype.x_b=function(P,Q){Q=z.Range.hd(Q.row.index+1,Q.column.index+1);return this.khc?Q.Hac(1===P||3===P,1===P||2===P):Q.Z3a(1===P||3===P,1===P||2===P,!0,!0)};Object(y.a)(h,"CellReferenceSequence",x,[]);Wl(m,w);Object(y.a)(m,"ColumnReference",w,[]);Wl(n,x);n.prototype.tbc=function(){var P=this.rv[0];return b(1012).RelativeAndAbsoluteReferencesManager.upf(P.firstColumn,P.secondColumn).kind===D.a.abs?2:3};n.prototype.x_b=
function(P,Q){return z.Range.jub(Q.firstColumn.index+1,Q.secondColumn.index+1).Z3a(1===P||3===P,!0,1===P||3===P,!0)};Object(y.a)(n,"ColumnReferenceSequence",x,[]);Wl(l,w);Object(y.a)(l,"RangeReference",w,[]);Wl(f,x);f.prototype.tbc=function(){var P=b(1012).RelativeAndAbsoluteReferencesManager,Q=this.rv[0];return P.Wqf(Q.top.kind===D.a.abs,Q.left.kind===D.a.abs)};f.prototype.x_b=function(P,Q){Q=new z.Range(Q.top.index+1,Q.left.index+1,Q.bottom.index+1,Q.right.index+1,!1,!1);var M=1===P||3===P;P=1===
P||2===P;return Q.Z3a(M,P,M,P)};Object(y.a)(f,"RangeReferenceSequence",x,[]);Wl(e,w);Object(y.a)(e,"RowReference",w,[]);Wl(c,x);c.prototype.tbc=function(){var P=this.rv[0];return b(1012).RelativeAndAbsoluteReferencesManager.upf(P.firstRow,P.secondRow).kind===D.a.abs?0:1};c.prototype.x_b=function(P,Q){return z.Range.t$b(Q.firstRow.index+1,Q.secondRow.index+1).Z3a(!0,1===P||2===P,!0,1===P||2===P)};Object(y.a)(c,"RowReferenceSequence",x,[]);var A=b(1181),B=b(1182),N=b(206);b.d(C,"RelativeAndAbsoluteReferencesManager",
function(){return a});a.prototype.Q0a=function(P,Q,M){var ba=Q;var V=M;if(!P||!N.e(P))return{returnValue:P,ixd:ba,hxd:V};var aa=this.calcManager.kRe(P);if(!aa)return t.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),{returnValue:null,ixd:ba,hxd:V};aa=this.NVh(aa,P,Q,M);for(var E=0,G="",I=0,R=0;R<aa.length;R++)if(this.yIe(aa[R],Q,M)){E=aa[R].tbc();ba=aa[R].start;break}for(;R<aa.length&&
this.yIe(aa[R],Q,M);R++)G+=P.substring(I,aa[R].start),G=aa[R].OJg(E,G),I=aa[R].end;I&&(V=G.length);G+=P.substring(I,P.length);return{returnValue:G,ixd:ba,hxd:V}};a.prototype.NVh=function(P,Q,M,ba){for(var V=[],aa=0;aa<P.length;aa++){var E=P[aa];if(E.kind===A.a.range)if(E=E.ref,E.type===B.a.cell){var G=E;E=Object(v.a)(new h,{start:E.span.start,end:E.span.end,rv:[Object(v.a)(new u,{column:G.col,row:G.row})],khc:this.calcManager.O1b(E.span.end,Q)});V.push(E)}else if(E.type===B.a.range)this.zIe(E.topLeftSpan,
M,ba)&&this.zIe(E.bottomRightSpan,M,ba)?(G=new l,E.top.index<=E.bottom.index?(G.top=E.top,G.bottom=E.bottom):(G.bottom=E.top,G.top=E.bottom),E.left.index<=E.right.index?(G.left=E.left,G.right=E.right):(G.right=E.left,G.left=E.right),E=Object(v.a)(new f,{start:E.topLeftSpan.start,end:E.bottomRightSpan.end,rv:[G]}),V.push(E)):(G=Object(v.a)(new h,{start:E.topLeftSpan.start,end:E.topLeftSpan.end,rv:[Object(v.a)(new u,{column:E.left,row:E.top})],khc:this.calcManager.O1b(E.topLeftSpan.end,Q)}),E=Object(v.a)(new h,
{start:E.bottomRightSpan.start,end:E.bottomRightSpan.end,rv:[Object(v.a)(new u,{column:E.right,row:E.bottom})],khc:this.calcManager.O1b(E.topLeftSpan.end,Q)}),V.push(G),V.push(E));else if(E.type===B.a.column){G=E;for(E=Object(v.a)(new n,{start:E.span.start,end:E.span.end,rv:[Object(v.a)(new m,{firstColumn:G.startIndex,secondColumn:G.endIndex})]});E.end<Q.length-1&&":"===Q.charAt(E.end)&&aa<P.length-1;)if(G=P[aa+1].ref,G.type===B.a.column&&G.span.start===E.end+1){var I=G;E.rv.push(Object(v.a)(new m,
{firstColumn:I.startIndex,secondColumn:I.endIndex}));E.end=G.span.end;aa++}else break;V.push(E)}else if(E.type===B.a.row){G=E;for(E=Object(v.a)(new c,{start:E.span.start,end:E.span.end,rv:[Object(v.a)(new e,{firstRow:G.startIndex,secondRow:G.endIndex})]});E.end<Q.length-1&&":"===Q.charAt(E.end)&&aa<P.length-1;)if(G=P[aa+1].ref,G.type===B.a.row&&G.span.start===E.end+1)I=G,E.rv.push(Object(v.a)(new e,{firstRow:I.startIndex,secondRow:I.endIndex})),E.end=G.span.end,aa++;else break;V.push(E)}}return V};
a.prototype.yIe=function(P,Q,M){return!(P.start>M||Q>P.end)};a.prototype.zIe=function(P,Q,M){return!(P.start>M||Q>P.end)};a.upf=function(P,Q){return P.index<=Q.index?P:Q};a.Wqf=function(P,Q){return Q||P?Q&&P?2:!Q&&P?3:0:1};Object(y.a)(a,"RelativeAndAbsoluteReferencesManager",null,[601])},1142:function(y,C,b){function a(z){var D=this;this.$=z;(this.vz=this.$.da.za(268))||e.ULS.shipAssertTag(537170070,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");var A=u.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?
x.a.current.hp(54):x.a.current.hp(57);this.logger=new h.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Xba=new c(z,this.vz);excelOnlineCalc.config.initCalc(this.logger,this.vz?function(B){return D.vz.isFeatureEnabled(B)}:function(){return!1},A);this.Qlg=excelOnlineCalc.config.calcConfig(this.Xba.localeInfo)}function c(z,D){z=b(1142).CalcHelper;D&&(D.Me||e.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));
this.vrg=z.qDe(D,z.dDe(D.ija));this.wrg=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}b.r(C);y=b(0);var e=b(15),f=b(277),l;(function(z){z[z.paren=0]="paren";z[z.lead=1]="lead";z[z.intern=2]="intern";z[z.trail=3]="trail";z[z.undefined=4]="undefined"})(l||(l={}));Object(y.b)("CurrencyFormatOption",l);var n;(function(z){z[z.none=-1]="none";z[z.mdy=0]="mdy";z[z.dmy=1]="dmy";z[z.ymd=2]="ymd";z[z.myd=3]="myd";z[z.dym=4]="dym";z[z.ydm=5]="ydm"})(n||(n={}));Object(y.b)("DateOrderOption",n);var m=
b(9);c.prototype.formatNumber=function(z){return this.localeInfo.formatNumber(z)};Ck.Object.defineProperties(c.prototype,{localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.wrg}},localeData:{configurable:!0,enumerable:!0,get:function(){return this.vrg}}});Object(y.a)(c,"LocaleHolder",null,[]);var h=b(1179),x=b(54),u=b(1),w=b(21),v=b(14),t=b(205);b.d(C,"CalcHelper",function(){return a});a.prototype.bah=function(){if(u.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.xa)return e.ULS.shipAssertTag(537170069,
0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;var z=this.$.xa.qa;return z?z.index:(e.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.xa.qa.index};a.prototype.createParser=function(){var z={};z.config=this.config;return excelOnlineCalc.parse.createParser(z)};a.prototype.createNumberFormatter=function(){var z=this,D=excelOnlineCalc.numfmt.createFormatGlobals(this.config,function(A,B){return excelOnlineCalc.calc.getTime(z.config,
A,B,"Estimation")});return excelOnlineCalc.numfmt.createNumberFormatter(D)};a.prototype.o9g=function(z,D,A,B){if(!B)return{range:{row:D,col:A},sheet:{document:this.documentLoc,index:z}};D=excelOnlineCalc.location.gridCell(D,A);z=excelOnlineCalc.location.sheetIndex(this.documentLoc,z);return excelOnlineCalc.location.sheetGridCell(z,D)};a.prototype.plh=function(z,D){var A=excelOnlineCalc.calc.getEvalResultKind(z);switch(A){case 4:return{returnValue:z?this.Xba.localeInfo.trueName:this.Xba.localeInfo.falseName,
kind:A};case 1:return{returnValue:u.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.sAc(this.Xba.formatNumber(z),D):this.Xba.formatNumber(z),kind:A};case 2:return{returnValue:u.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.sAc(z.toString(),D):z.toString(),kind:A};case 128:return{returnValue:"",kind:A};case 8:switch(z.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.Xba.localeInfo.errorNames[z.type],
kind:A};default:return{returnValue:a.unknownError,kind:A}}case 32:return{returnValue:u.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.sAc(this.F9g(z,D),D):"##UNSUPPORTED: ARRAY",kind:A};default:return{returnValue:v.a.instance.ga(2181),kind:A}}};a.prototype.sAc=function(z,D){return z.length<=D?z:z.substring(0,D-3)+"..."};a.prototype.F9g=function(z,D){for(var A=this.Xba.localeInfo.leftBrace,B=0;B<z.rows;++B){for(var N=0;N<z.cols;++N)A+=z.opers[B][N],N<
z.cols-1&&(A+=this.Xba.localeInfo.columnSeparator);B<z.rows-1&&(A+=this.Xba.localeInfo.rowSeparator)}return this.sAc(A,D-1)+this.Xba.localeInfo.rightBrace};a.qDe=function(z,D){D=void 0===D?null:D;var A=a.s4b(),B=z.Me.TrueValueString,N=z.Me.FalseValueString,P=z.Me.DecimalSeparator.toString(),Q=z.Me.ListSeparator.toString(),M=z.Me.ColumnSeparator.toString(),ba=z.Me.RowSeparator.toString(),V=z.Me.ThousandsDataArray,aa=z.Me.ThousandSeparator.toString(),E=z.Me.Lcid,G=z.Me.Country,I=z.Me.DigitsNumber,R=
z.Me.ExpSeparatedBySpace,Y=z.Me.FractionSeparator.toString(),U=z.Me.PercentSeparatedBySpace,ha=w.a.tUg(Enum.toString(l,z.Me.CurrencyFormat)),ta=z.Me.CurrencySymbolLead,xa=z.Me.CurrencySeparatedBySpace,oa=z.Me.CurrencySymbolString,qa=z.Me.DigitsCurrency,Ea=-1===z.Me.DateOrder?"MDY":t.e(Enum.toString(n,z.Me.DateOrder)),ka=z.Me.DateSeparator.toString(),za=z.Me.DateAlternativeSeparator.toString(),La=z.Me.Year4Digits,Ia=z.Me.Month2Digits,Ya=z.Me.Day2Digits,tb=z.Me.LongDateFormat,Tb=z.Me.TimeSeparator.toString(),
va=z.Me.TimeAltSeparator,la=z.Me.Hour2Digits,$a=z.Me.Use24HourClock,Ra=z.Me.AmPmSeparatedBySpace,eb=[z.Me.AmString,z.Me.PmString],mb=z.Me.DayNameShortArray,Pa=z.Me.DayNameLongArray,Da=z.Me.MonthNameShortArray,Ta=z.Me.MonthNameLongArray,Sa=z.Me.PictureSpecialArray,Cb=f.a.map(("\x00"+z.Me.PictureSingleString).split(""),function(Rb){return"\x00"===Rb?null:Rb}),cc=z.Me.PictureColorArray,nc=z.Me.PictureDbnumArray,Nb=z.Me.RowLetter.toString(),nb=z.Me.ColumnLetter.toString(),db=z.Me.LeftBrace.toString(),
Bb=z.Me.RightBrace.toString(),zc=z.Me.LeftBracket.toString(),Eb=z.Me.RightBracket.toString(),Ja=a.IWh(z.Me);return excelOnlineCalc.calc.localeData(D,A,B,N,Nb,nb,db,Bb,zc,Eb,P,Q,M,ba,V,aa,E,G,I,R,Y,U,ha,ta,xa,oa,qa,Ea,ka,za,La,Ia,Ya,tb,Tb,va,la,$a,Ra,eb,mb,Pa,Da,Ta,Sa,Cb,cc,nc,Ja,z.Me.SysDateFormatString,z.Me.SysTimeFormatString)};a.dDe=function(z){var D=[];if(!z)return D;z=Gl(z);for(var A=z.next();!A.done;A=z.next()){A=A.value;var B=null;A.IsDynamicUdf||(B=excelOnlineCalc.calc.worksheetFunctionName(A.FunctionIndexInServer,
A.NameUI));B&&D.push(B)}return D};a.s4b=function(){for(var z=[],D=Object.keys(m.a.errorNames),A=0;A<D.length;A++){var B=excelOnlineCalc.calc.errorTypeName(A+1,D[A]);B&&z.push(B)}return z};a.IWh=function(z){var D=Array(6);D[1]="#"+z.AllStructRefString;D[3]="#"+z.HeadersStructRefString;D[2]="#"+z.DataStructRefString;D[4]="#"+z.TotalsStructRefString;D[5]="#"+z.ThisRowStructRefString;return D};Ck.Object.defineProperties(a.prototype,{config:{configurable:!0,enumerable:!0,get:function(){return this.Qlg}}});
a.unknownError="##ERR##";Object(y.a)(a,"CalcHelper",null,[])},1181:function(y,C,b){function a(){}b.d(C,"a",function(){return a});y=b(0);a.Wqi="literal";a.operator="operator";a.func="function";a.namedRange="namedRange";a.range="range";a.zjf="letName";a.all="*";a.zTd="structRefRange";Object(y.a)(a,"TraverseFormulaInterestTypes",null,[])},1182:function(y,C,b){function a(){}b.d(C,"a",function(){return a});y=b(0);a.cell="cell";a.range="range";a.row="row";a.column="col";Object(y.a)(a,"TraverseFormulaRefTypes",
null,[])},1457:function(y,C,b){function a(Qa){var cb=Ib.call(this)||this;cb.$=Qa;cb.Tb();return cb}function c(Qa){var cb=Xa.call(this)||this;cb.$=Qa;cb.Tb();return cb}function e(Qa,cb){var lb=this;this.cka=this.ZTd=this.jmf=!1;this.P8=null;this.LDb=function(){lb.cka=!1};this.Rc=Qa;this.gridView=va.g(Qa);this.calcManager=cb;this.fii=Ia.EwaSettings.isChangeGateEnabled("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.uaf=Ia.EwaSettings.ma(691);this.vba=nb.a.vba(Qa);this.gridView.pc.Kn(this.LDb)}
function f(Qa,cb,lb,Ha){this.GGj=Qa;this.V7f=cb;this.nhc=void 0===Ha?!1:Ha;lb?(this.Vwa=lb.Vwa,this.YZ=lb.YZ,this.XZ=lb.XZ,this.c5=lb.c5,this.b5=lb.b5):aa.ULS.shipAssertTag(524039642,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}function l(Qa){this.b5=this.c5=this.XZ=this.YZ=!1;this.Vwa=Qa}function n(Qa){var cb=sc.call(this)||this;cb.$=Qa;cb.Tb();return cb}function m(Qa){var cb=this;this.Hl=null;this.ffg=!1;this.JKd=this.instantaneousSupportInformationManager=this.DFb=null;this.$xd=new Map;this.Abe=
null;this.ync=function(lb){aa.ULS.sendTraceTag(537170005,0,50,"CalcManager.OnLocaleInformationAvailable() called");lb.JId(cb.ync);lb.ija.length?cb.enc(lb,Sys.EventArgs.Empty):(aa.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),lb.Hme(cb.enc))};this.enc=function(lb){aa.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");lb.AId(cb.enc);cb.yLj(lb)};this.onContentReady=function(){cb.Hl&&(cb.instantaneousSupportInformationManager&&
cb.instantaneousSupportInformationManager.Jld||Vb.Task.delay(0).CWCT(function(){cb.Hl.Keb(1)},null,0,mc.a.current))};this.Btf=function(lb,Ha){cb.Hl&&(cb.instantaneousSupportInformationManager&&cb.instantaneousSupportInformationManager.Jld||cb.Hl.zEe(Ha.nd.block))};aa.ULS.sendTraceTag(537170067,0,50,"Creating CalcManager");this.Raf=!1;this.xb=Qa;this.fr=va.g(Qa);this.PFc=null;this.gridView.Mt(this.onContentReady);this.gridView.Ea.LUc(this.Btf);this.$.da.$a(268,function(lb){lb.Me?(aa.ULS.sendTraceTag(537170066,
0,50,"CalcManager.ctor: LocaleInformation already available..."),cb.ync(lb,Sys.EventArgs.Empty)):(aa.ULS.sendTraceTag(537170065,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),lb.bne(cb.ync))})}function h(){}function x(){}function u(){this.b5=this.c5=this.XZ=this.YZ=this.Vwa=!1}function w(Qa){var cb=this;this.xGd=null;this.dtd=this.wGd=this.HEb=!1;this.wEd=0;this.mEd=this.oEd=this.pEd=this.nEd=-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.Vm=
this.errorTypeNames=null;this.fq=this.currentStateId=-1;this.xta="";this.S$=null;this.ozf=function(){cb.setNumberFormats()};this.vd=function(){aa.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");cb.af=new $a.a;cb.fq=-1;cb.currentStateId=-1;cb.xta="";cb.Arb=null;cb.wGd=!1;cb.Vm&&cb.clearCache()};this.n4f=(this.Rc=Qa)?Qa.ya.CalcWebWorkerSmokeTestPingIntervalMS:this.n4f;this.af=new $a.a;this.Arb=null;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.Rc.workbookContext.FullDocumentInfo.BreadcrumbDocName);
this.Boa();this.$nd=nb.a.$nd()}function v(Qa){this.$2d=null;this.init(Qa)}function t(){}function z(Qa){this.x7=Qa;this.b6=new Ta.a(Sa.a.Qk());this.Blc=!1}function D(Qa){this.Adg=Qa;this.age=[];this.Yag=[];this.d_a={};this.JPd=new Map}function A(Qa,cb,lb,Ha,$b){this.type=Qa;this.fullName=cb;this.range=lb;this.sheetId=Ha;this.attributes=$b;this.rE=null}function B(Qa,cb){this.Que=Qa;this.sheetName=cb;this.nvc=!1}function N(Qa){var cb=eb.call(this)||this;cb.$=Qa;cb.Tb();return cb}function P(Qa,cb){var lb=
Ra.call(this)||this;lb.fNa=Y.a.Re;lb.fZc=null;lb.Wic=!1;lb.tfb=!1;lb.Gsf=function(Ha,$b){var Jb;(Ha=va.g(lb.$))&&($b=null!==(Jb=null===$b||void 0===$b?void 0:$b.cell)&&void 0!==Jb?Jb:Ha.lc(null))&&lb.lTa($b.cell.il,!0)};lb.oJi=function(Ha){lb.isActive()&&(La.a.mr(Ha.Errors)||!Ha.Result?aa.ULS.sendTraceTag(537155726,0,50,"GetCategoryFromServer failed, ignoring - server errors: {0}",Ha.Errors?Ha.Errors.join(","):"None"):(Ha=Ha.Result,aa.ULS.sendTraceTag(537155725,0,50,"Updating number format category cache, format index = {0}, category = {1}",
Ha.Index,Ha.Category),lb.Jpj(Ha.Index,Ha.Category),lb.raiseEvent(P.f_c,new ha.a(Ha.Index,Ha.Category),lb)))};lb.refresh=function(){aa.ULS.sendTraceTag(537155722,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");lb.A1b();lb.isActive()&&lb.ea.xc.allowEdits&&(lb.tfb||lb.tn&&!(lb.ea.mBb>lb.fNa)?lb.TCc():(aa.ULS.sendTraceTag(537155721,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information."),lb.yed=oa.a(lb.$.na.va,lb.tn?lb.tn.Digest:"",lb.XJi,
lb.WJi,null,null)),aa.ULS.sendTraceTag(537155720,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info."),lb.OYe())};lb.Qwf=function(Ha){aa.ULS.sendTraceTag(537155716,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = {0}, HTTP status = {1}.",Ha.data.status,Ha.data.httpStatus);lb.$Ja=null};lb.Q_=function(){lb.tfb=!1;lb.ea.LF(lb.Q_);lb.NQa(lb.Wic?P.VPd:P.xxd)};lb.od=function(Ha,$b){aa.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");
ta.a($b)&&lb.NQa(P.VPd)};lb.Hf=function(){aa.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==lb.$.workbookContext.CalcMode&&lb.Jxd(0===lb.$.workbookContext.CalcMode)};lb.vd=function(){aa.ULS.sendTraceTag(537155713,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");lb.NQa(P.VPd);Ia.EwaSettings.ma(302)&&3!==lb.$.workbookContext.CalcMode&&lb.Jxd(0===lb.$.workbookContext.CalcMode)};lb.PJi=function(Ha,$b,Jb){aa.ULS.sendTraceTag(537155712,
0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");lb.$Ja=null;lb.isActive()?Ha.StateId===Y.a.Re?(aa.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),lb.TCc()):!Ha.Result||lb.YX&&lb.YX.length?lb.NQa(P.xxd):lb.xAf(Ha,$b,Jb):aa.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};lb.xAf=function(Ha){lb.YX=Ha.Result;
aa.ULS.sendTraceTag(537155681,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned {0} functions.",lb.YX?lb.YX.length:-1);Ha=!1;if(lb.YX){for(var $b=Gl(lb.YX),Jb=$b.next();!Jb.done;Jb=$b.next())if(Jb=Jb.value)lb.FUe[Jb.NameUI.toLocaleUpperCase()]=Jb.FunctionIndex.toString(),Jb.NameUI!==Jb.NameDataStrings&&(lb.FUe[Jb.NameDataStrings.toLocaleUpperCase()]=Jb.FunctionIndex.toString(),Ha=!0),lb.FDh.ia(Jb.FunctionIndex,Jb.NameUI);lb.raiseEvent(P.Dbd,
Sys.EventArgs.Empty,lb)}Ha&&aa.ULS.sendTraceTag(537155680,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};lb.XJi=function(Ha){if(lb.isActive())if(aa.ULS.shipAssertTag(537155679,0,!!lb.$,"null ewaControl"),lb.Wic=!1,lb.fNa=Ha.StateId,lb.fNa===Y.a.Re)lb.Wic=!0,lb.TCc();else{if(Ha.Result){var $b=lb.tn;lb.tn=Ha.Result;aa.ULS.sendTraceTag(537155678,0,50,"InstantaneousSupportInformation updated, new result digest: {0}.",lb.tn.Digest);Ha=
[];if($b)Ha=P.VQh($b.NumberFormats,lb.tn.NumberFormats);else for($b=0;$b<lb.tn.NumberFormats.length;$b++)lb.bmc.ia($b,lb.tn.NumberFormats[$b].NumberFormatCategory);$b=Gl(Ha);for(var Jb=$b.next();!Jb.done;Jb=$b.next())Jb=Jb.value,lb.bmc.ia(Jb,lb.tn.NumberFormats[Jb].NumberFormatCategory);lb.raiseEvent(P.eyd,new M(Ha),lb);Ia.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",!1)&&lb.raiseEvent(P.ykf)}lb.NQa(P.xxd)}};lb.WJi=function(Ha){lb.isActive()&&(10===
Ha.data.status?aa.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):(aa.ULS.sendTraceTag(21311555,0,10,"Failed to update instantaneous support information, status = {0}, HTTP status = {1}.",Ha.data.status,Ha.data.httpStatus),lb.Wic=!0,lb.TCc()))};aa.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");lb.ea=Qa;lb.$=cb;lb.iHb=null;lb.yed=null;lb.$Ja=null;lb.tn=null;lb.bmc=new $a.a;lb.Hub=new $a.a;lb.YX=[];lb.FDh=new $a.a;lb.FUe=
{};lb.ea.hk(lb.od);lb.$.dl(lb.vd);va.g(lb.$).ha.Ura(lb.Gsf);Ia.EwaSettings.ma(302)&&lb.ea.Nt(lb.Hf);lb.NQa(P.L8e);aa.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end");return lb}function Q(Qa){this.data=Qa}function M(Qa){var cb=qa.call(this)||this;cb.nZj=Qa;return cb}function ba(Qa){if(Qa){var cb=new l(Qa.IsRangeRef);cb.YZ=Qa.IsAbsoluteFirstRow;cb.XZ=Qa.IsAbsoluteFirstColumn;cb.c5=Qa.IsAbsoluteSecondRow;cb.b5=Qa.IsAbsoluteSecondColumn;return cb}}function V(Qa){var cb;
if(Qa){var lb=new l(0===Qa.kind);Qa=null===(cb=null===Qa||void 0===Qa?void 0:Qa.rangeInfo)||void 0===cb?void 0:cb.positionKindInfo;if(!Qa)return lb;lb.YZ=0===Qa.firstRow;lb.XZ=0===Qa.firstColumn;lb.c5=0===Qa.secondRow;lb.b5=0===Qa.secondColumn;return lb}}b.r(C);y=b(11);C=b(0);var aa=b(15),E=b(229),G=b(91),I=b(4),R=b(202),Y=b(9),U=b(38),ha=b(1082),ta=b(232),xa=b(83),oa=b(1027),qa=Sys.EventArgs;Wl(M,qa);Object(C.a)(M,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);var Ea=b(47),ka=b(43),za=b(35),La=
b(30),Ia=b(1),Ya=b(708),tb=b(21),Tb=b(292),va=b(22),la=b(206);Object(C.a)(Q,"NumberFormatDataHolder",null,[]);var $a=b(170),Ra=U.a;Wl(P,Ra);P.prototype.bne=function(Qa){this.addHandler(P.eyd,Qa)};P.prototype.JId=function(Qa){this.removeHandler(P.eyd,Qa)};P.prototype.xDg=function(Qa){this.addHandler(P.f_c,Qa)};P.prototype.R9i=function(Qa){this.removeHandler(P.f_c,Qa)};P.prototype.Hme=function(Qa){this.addHandler(P.Dbd,Qa)};P.prototype.AId=function(Qa){this.removeHandler(P.Dbd,Qa)};P.prototype.ZEg=
function(Qa){this.addHandler(P.ykf,Qa)};P.prototype.lTa=function(Qa,cb){var lb=this.bmc.Nc(Qa,0);var Ha=lb.value;lb=lb.returnValue;!lb&&0<Qa&&this.$&&(aa.ULS.sendTraceTag(537155735,0,50,"InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache {0}",Qa),this.XIh(Qa),cb&&(Ha=this.WIh(Qa),lb=!0),Ya.a(Qa,this.$.jG)&&(Ha=6));return{returnValue:lb,category:Ha}};P.prototype.Igi=function(Qa){var cb=this.lTa(Qa,!0);var lb=cb.category;if(cb.returnValue)return 6===
lb;aa.ULS.sendTraceTag(537155733,0,50,"InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index {0}",Qa);return!1};P.prototype.cCh=function(Qa){aa.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.$Ja=xa.x(this.$.na.va,{FilterType:0},Tb.b(this.xAf,Qa),this.Qwf,null,null,null)};P.prototype.XTe=function(){this.NQa(P.L8e)};P.prototype.Jxd=function(Qa){this.fZc=Qa};
P.prototype.XIh=function(Qa){if(this.Hub&&this.$){var cb=this.Hub.Nc(Qa);var lb=cb.value;if(!cb.returnValue||lb.isCompleted)aa.ULS.sendTraceTag(537155728,0,50,"Getting number format category for format index: {0}",Qa),(lb=oa.b(this.$.na.va,Qa,this.oJi,null,null,null))&&this.Hub.ia(Qa,lb)}else aa.ULS.sendTraceTag(537155729,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")};P.prototype.WIh=function(Qa){return 1<=Qa&&8>=Qa?1:9<=Qa&&12>=Qa?
2:13===Qa||14===Qa?6:15===Qa?8:17===Qa|18===Qa?7:19===Qa?4:16===Qa||20<=Qa&&29>=Qa||31===Qa?11:30===Qa?9:32<=Qa&&35>=Qa?3:0};P.prototype.isActive=function(){var Qa=void 0===this.ea||null===this.ea,cb=!Qa&&this.ea.rc;aa.ULS.sendTraceTag(537155727,0,50,"InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:{0} - sessionStateManager IsNullOrUndefined: {1}",cb,Qa);return cb};P.prototype.Jpj=function(Qa,cb){this.bmc.ia(Qa,cb)};P.prototype.dispose=function(){G.a.Ha(this.iHb);
this.iHb=null;this.A1b();for(var Qa=Gl(this.Hub),cb=Qa.next();!cb.done;cb=Qa.next())(cb=cb.value.value)&&!cb.isCompleted&&I.AFrameworkApplication.Jd.yu(cb.Pt);this.Hub=null;this.ea&&(this.ea.Dk(this.od),this.tfb&&this.ea.LF(this.Q_),this.tfb=!1,this.ea.uv(this.Hf));this.ea=null;this.$&&va.g(this.$)&&va.g(this.$).ha&&(va.g(this.$).ha.Aza(this.Gsf),this.$.yl(this.vd));this.$=null;Ra.prototype.dispose.call(this)};P.prototype.isFeatureEnabled=function(Qa){try{switch(Qa){case "LocaleLongDateFormat":return Ia.EwaSettings.ma(197);
case "GetLocaleDayNames":return Ia.EwaSettings.ma(198);case "CalculateTextWidthIgnoreLetterSpacing":return Ia.EwaSettings.ma(284);case "OfficeVSO:3657744_CalcFixForDateFormat":return Ia.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return Ia.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");case "CalcAutocompleteExperiment":return Ia.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",
!1);case "CalcNewFunctions":return Ia.EwaSettings.ma(247);case "CalcContractChecks":return Ia.EwaSettings.ma(248);case "CalcSupportDynamicArrays":return Ia.EwaSettings.ma(249);case "CalcFormatCalculations":return Ia.EwaSettings.ma(250);case "CalcFormulaCacheAPIChanges":return Ia.EwaSettings.ma(251);case "CalcStrictFormulaChecking":return Ia.EwaSettings.ma(252);case "CalcSupportRowReference":return Ia.EwaSettings.ma(263);case "CalcParserUsesPledges":return Ia.EwaSettings.ma(307);case "CalcWebWorker":return!0;
case "CalcWebWorkerTest":return Ia.EwaSettings.ma(306);case "CalcLookupFunctions":return Ia.EwaSettings.ma(308);case "CalcLogStopWatch":return Ia.EwaSettings.ma(372);case "CalcPreventSpillingHack":return Ia.EwaSettings.ma(253);case "CalcDynamicArrayOperators":return Ia.EwaSettings.ma(103);case "CalcDotOperator":return Ia.EwaSettings.ma(586);case "CalcLetFunction":return Ia.EwaSettings.ma(702);default:return Qa.startsWith("OfficeVSO:")?Ia.EwaSettings.isChangeGateEnabled(Qa):!1}}catch(cb){return aa.ULS.sendTraceTag(537155724,
0,15,"InstantaneousSupportInformation.IsFeatureEnabled({0}): feature parsing failed, returning false. Exception: {1}.",Qa,cb.toString()),!1}};P.prototype.NQa=function(Qa){this.isActive()&&this.ea.xc.allowEdits?(G.a.Ha(this.iHb),this.iHb=null,this.iHb=Ea.a.instance.create(this.refresh,Qa,ka.a.ebi)):aa.ULS.sendTraceTag(537155723,0,50,"InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits {0}, IsEditMode {1}",void 0!==this.ea&&null!==this.ea&&void 0!==
this.ea.xc&&null!==this.ea.xc?this.ea.xc.allowEdits:!1,void 0===this.ea||null===this.ea?!1:this.$.ea.isEditMode)};P.prototype.OYe=function(){aa.ULS.sendTraceTag(537155719,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.$Ja?aa.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.YX&&this.YX.length||(this.$Ja=xa.x(this.$.na.va,{FilterType:0},this.PJi,this.Qwf,null,null,null)):
aa.ULS.sendTraceTag(537155717,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")};P.prototype.TCc=function(){this.tfb||(this.tfb=!0,this.ea.FG(this.Q_))};P.prototype.A1b=function(){this.yu(this.yed);this.yu(this.$Ja);this.$Ja=this.yed=null};P.prototype.yu=function(Qa){Qa&&!Qa.isCompleted&&this.$.na.va.xeb(Qa.Pt)};P.VQh=function(Qa,cb){if(!Qa||!Qa.length)return[];if(!cb||!cb.length){cb=Array(Qa.length);for(var lb=0;lb<Qa.length;++lb)cb[lb]=Qa[lb].IfmtIndex;
return cb}var Ha=new $a.a;Qa=Gl(Qa);for(lb=Qa.next();!lb.done;lb=Qa.next())lb=lb.value,Ha.ia(lb.IfmtIndex,new Q(lb));Qa=new R.a;lb={};cb=Gl(cb);for(var $b=cb.next();!$b.done;lb={Qfb:lb.Qfb,CPb:lb.CPb},$b=cb.next())lb.Qfb=$b.value,lb.CPb=void 0,function(Jb){return function(){var kc=Ha.Nc(Jb.Qfb.IfmtIndex);Jb.CPb=kc.value;return kc}}(lb)().returnValue&&lb.CPb.data.FormatString===lb.Qfb.FormatString||Qa.add(lb.Qfb.IfmtIndex);return Qa.toArray()};Ck.Object.defineProperties(P.prototype,{Me:{configurable:!0,
enumerable:!0,get:function(){return this.tn?this.tn.LocaleInformation:null}},dya:{configurable:!0,enumerable:!0,get:function(){return this.tn?this.tn.NumberFormats:[]}},ija:{configurable:!0,enumerable:!0,get:function(){this.YX&&this.YX.length||this.OYe();return this.YX}},abi:{configurable:!0,enumerable:!0,get:function(){return this.tn&&void 0!==this.tn.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.tn.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.tn.InstantaneousCalcWebWorkerPrecisionSamplingRate:
P.Jbh}},dbi:{configurable:!0,enumerable:!0,get:function(){return this.tn&&void 0!==this.tn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.tn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.tn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:P.Nbh}},cbi:{configurable:!0,enumerable:!0,get:function(){return this.tn&&void 0!==this.tn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&null!==this.tn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.tn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:
P.Mbh}},bbi:{configurable:!0,enumerable:!0,get:function(){return this.tn&&void 0!==this.tn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.tn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.tn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:P.Lbh}},z$e:{configurable:!0,enumerable:!0,get:function(){return this.tn?this.tn.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:P.Kbh}},Jld:{configurable:!0,enumerable:!0,get:function(){return null!==this.fZc?this.fZc:
this.tn?this.tn.InstantaneousCalcManualMode:!1}}});P.eyd="isim0";P.f_c="isim1";P.Dbd="isim2";P.ykf="isim3";P.L8e=100;P.VPd=1E3;P.xxd=3E5;P.Jbh=.001;P.Nbh=.1;P.Mbh=.2;P.Lbh=.001;P.Kbh=50;Object(C.a)(P,"InstantaneousSupportInformationManager",U.a,[491,3]);var eb=E.a;Wl(N,eb);N.prototype.create=function(){this.$&&(aa.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script"),this.Eb(this.$.da.za(268)||new P(this.$.ea,this.$)))};N.ka=function(Qa){if(!Qa)throw Error.argumentNull("ewaControl");
Qa.da.Ga(246,new N(Qa))};Object(C.a)(N,"InstantaneousSupportInformationManagerFactory",E.a,[]);var mb=b(82),Pa=b(113),Da=b(85);Object(C.a)(B,"CalcBlockInformation",null,[]);Object(C.a)(A,"CalcNamedObject",null,[]);D.prototype.YZf=function(Qa,cb){this.age[Qa]=cb;this.Adg&&cb.x7&&this.JPd.set(cb.x7.sheetName,Qa)};D.prototype.getSheetIndex=function(Qa){if(this.Adg){if(this.JPd.has(Qa))return this.JPd.get(Qa)}else for(var cb=1;cb<this.Hj.length;cb++)if(tb.a.equals(this.Hj[cb].x7.sheetName,Qa,!1))return cb;
return-1};Ck.Object.defineProperties(D.prototype,{Hj:{configurable:!0,enumerable:!0,get:function(){return this.age}}});Object(C.a)(D,"GridCache",null,[]);var Ta=b(892),Sa=b(613);Object(C.a)(z,"SheetInformation",null,[]);var Cb=b(1142),cc;(function(Qa){Qa[Qa.initialization=0]="initialization";Qa[Qa.contentReady=1]="contentReady";Qa[Qa.cellEdit=2]="cellEdit"})(cc||(cc={}));Object(C.b)("UpdateDataTrigger",cc);var nc=b(63);t.local="Local";t.WGj="Thread";Object(C.a)(t,"RecalcServiceCreateMode",null,[]);
var Nb=b(45),nb=b(36),db=b(168);v.prototype.init=function(Qa){this.$2d=new $a.a;if(void 0!==Qa&&null!==Qa&&void 0!==Qa.HeadersList&&null!==Qa.HeadersList&&0<Qa.HeadersList.length){Qa=Gl(Qa.HeadersList);for(var cb=Qa.next();!cb.done;cb=Qa.next())cb=cb.value,this.A$.ia(cb.Index,cb.Name)}};Ck.Object.defineProperties(v.prototype,{A$:{configurable:!0,enumerable:!0,get:function(){return this.$2d}}});Object(C.a)(v,"ColHeadersListData",null,[]);var Bb=b(100);b(205);var zc=b(258);w.prototype.dispose=function(){this.instantaneousSupportInformationManager&&
this.instantaneousSupportInformationManager.JId(this.ozf);this.Rc&&this.Rc.yl(this.vd);this.close()};w.prototype.Keb=function(Qa){if(!this.Vm)return!1;if(!this.instantaneousSupportInformationManager&&(this.instantaneousSupportInformationManager=this.Rc.da.za(268),!this.instantaneousSupportInformationManager))return aa.ULS.sendTraceTag(537170198,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),!1;2!==Qa&&(this.currentStateId=this.Rc.ea.mBb,this.currentStateId===
Y.a.Re&&(this.currentStateId=this.Rc.ea.Te));if(1===Qa&&this.currentStateId<this.fq)return aa.ULS.sendTraceTag(537170197,0,50,"CalcAsyncEngine::UpdateData() currentStateId:{0} < lastUpdatedStateId:{1} - ignoring update",this.currentStateId,this.fq),!1;this.Jnj();0!==Qa&&this.wGd||(this.Xrj(),this.cpj(),this.Ppj(),this.setNumberFormats(),this.instantaneousSupportInformationManager.bne(this.ozf),this.Rc.dl(this.vd),this.wGd=!0);this.K4i();var cb=!1;0===Qa&&(cb=this.Q9h());if(0!==Qa||cb)this.irj()?(this.Mrj(Qa),
this.Lrj(),this.fq=this.currentStateId,this.cXg()):aa.ULS.sendTraceTag(537170196,0,15,"CalcAsyncEngine::UpdateData() for StateId:{0} failed - no Sheets information",this.currentStateId);2!==Qa&&this.resumeRecalc();return!0};w.prototype.evalFormula=function(Qa){if(!this.Vm)return aa.ULS.sendTraceTag(537170195,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});Qa=this.Vm.evalFormula(this.Rc.ea.Te,Qa,nc.d(this.Rc.xa.qa));this.resumeRecalc();return Qa};w.prototype.evalFormulaRange=
function(Qa,cb,lb){if(!this.Vm)return aa.ULS.sendTraceTag(537170194,0,15,"CalcAsyncEngine.EvalFormulaRange: recalc engine is null"),Promise.reject(null);aa.ULS.shipAssertTag(537170193,0,cb.isSingle,"CalcAsyncEngine.EvalFormulaRange: originCell Range must be a single cell.");lb=Nb.j(lb);cb=Nb.o(cb,this.Rc);cb=excelOnlineCalc.calc.cellLocation(cb.FirstRow,cb.FirstColumn);lb=w.DU("EvalFormulaRange",nc.d(this.Rc.xa.qa),lb.FirstRow,lb.FirstColumn,lb.LastRow,lb.LastColumn);aa.ULS.sendTraceTag(537170190,
0,50,"CalcAsyncEngine.EvalFormulaRange: calling calc.ts's EvalFormulaRange API for state ID {0}",this.fq);Qa=this.Vm.evalFormulaRange(this.fq,Qa,cb,lb,null);Qa.then(function(Ha){if(excelOnlineCalc.util.isSuccess(Ha)){var $b=[];Ha=Gl(Ha.value);for(var Jb=Ha.next();!Jb.done;Jb=Ha.next())Jb=Jb.value,excelOnlineCalc.util.isSuccess(Jb.value)||(Jb=Jb.value.reason.kind.toString(),Array.contains($b,Jb)||$b.push(Jb));aa.ULS.sendTraceTag(537170191,0,50,"CalcAsyncEngine.EvalFormulaRange - Evaluation of range complete. FailureReasons: {0}",
$b.length?Sys.Serialization.JavaScriptSerializer.serialize($b):"None")}else aa.ULS.sendTraceTag(537170192,0,15,"CalcAsyncEngine.EvalFormulaRange: Calc.EvalFormulaRange returned a failed object. failure reason: {0}",Ha.reason.kind)}).catch(function(Ha){aa.ULS.sendTraceTag(537170189,0,10,"CalcAsyncEngine.EvalFormulaRange - promise rejected: {0}",Sys.Serialization.JavaScriptSerializer.serialize(Ha));return Promise.reject(Ha)});this.resumeRecalc();return Qa};w.prototype.PSg=function(Qa,cb,lb,Ha){Ha=void 0===
Ha?null:Ha;if(this.Vm&&Qa){var $b=nc.d(this.Rc.xa.qa),Jb=Qa.cell.cK-1,kc=Qa.cell.bK-1,uc=Jb,hd=kc,ma=null;Ha&&(ma=excelOnlineCalc.calc.cellLocation(Jb,kc),Jb=Ha.top-1,kc=Ha.left-1,uc=Ha.bottom-1,hd=Ha.right-1);if(Qa.cell.cu)if(Ha=Qa.cell.cu.bYc,Ha===Y.a.Re)aa.ULS.sendTraceTag(537170187,0,15,"CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:{0}",Qa.cell.cu.$d);else if(Ha<this.fq)aa.ULS.sendTraceTag(537170185,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}",
Jb,kc,Ha,this.fq);else if(Ha<this.currentStateId)aa.ULS.sendTraceTag(537170184,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}",Jb,kc,Ha,this.currentStateId);else if(this.HEb||(this.Vm.setOnRecalcResults(lb),this.HEb=!0),this.Lag()&&!this.Keb(2))aa.ULS.sendTraceTag(537170183,0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");else{hd=w.DU("CalculateFormula.cell",$b,Jb,kc,uc,hd);lb=[];var jb=va.g(this.Rc);uc=jb.Gh;va.g(this.Rc).rb.$i&&
(uc=jb.Uf(1).Gh,uc.Ana(1,1),uc.Ana(3,1));jb=null;uc?jb=w.DU("CalculateFormula.viewport",$b,uc.top-1,uc.left-1,uc.bottom-1,uc.right-1):aa.ULS.sendTraceTag(537170182,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");cb=excelOnlineCalc.calc.inferredRangeFormulaEdit(hd,cb,ma,jb);lb.push(cb);Qa=uc?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",$b,Jb,kc,tb.a.j_b(Qa.cell.text),
Ha,uc.top-1,uc.left-1,uc.bottom-1,uc.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",$b,Jb,kc,tb.a.j_b(Qa.cell.text),Ha,"","","","");aa.ULS.sendTraceTag(537170181,0,50,Qa);this.Vm.editRangeFormulas(Ha,lb);this.resumeRecalc()}else aa.ULS.sendTraceTag(537170186,0,15,"CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:({0},{1})",Qa.cell.cK,Qa.cell.bK)}else aa.ULS.sendTraceTag(537170188,0,15,
"CalcAsyncEngine::CalculateFormula() recalc engine is null:{0}, modifiedCell is null:{1}",!this.Vm,!Qa)};w.prototype.NSg=function(Qa,cb,lb,Ha){Ha=void 0===Ha?null:Ha;var $b=nc.d(this.Rc.xa.qa),Jb=Qa.cell.cK-1,kc=Qa.cell.bK-1,uc=Jb,hd=kc,ma=null;Ha&&(ma=excelOnlineCalc.calc.cellLocation(Jb,kc),Jb=Ha.top-1,kc=Ha.left-1,uc=Ha.bottom-1,hd=Ha.right-1);lb=this.ZYd(Qa,lb,"SetCell");0>lb||(hd=w.DU("CalculateFormula.cell",$b,Jb,kc,uc,hd),uc=[],Ha=this.Sgd($b),cb=excelOnlineCalc.calc.inferredRangeFormulaEdit(hd,
cb,ma,Ha),uc.push(cb),Qa=(cb=this.b3e())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",$b,Jb,kc,tb.a.j_b(Qa.cell.text),lb,cb.top-1,cb.left-1,cb.bottom-1,cb.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",$b,Jb,kc,tb.a.j_b(Qa.cell.text),lb,"","","",""),aa.ULS.sendTraceTag(537170180,0,50,Qa),this.Vm.editRangeFormulas(lb,uc),
this.resumeRecalc())};w.prototype.atb=function(Qa,cb,lb,Ha){if(!this.Vm)return aa.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),Promise.reject("RecalcService is null");if(!lb||!cb)return aa.ULS.sendTraceTag(524120779,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone inputs are null. originCell null: "+!lb+", outputColumnRange null: "+!cb),Promise.reject("CalcAsyncEngine::EvalFormulaRangeOnClone: null inputs");aa.ULS.shipAssertTag(537170178,0,lb.isSingle,
"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");var $b=nc.d(this.Rc.xa.qa),Jb=this.Sgd($b),kc=null;if(Qa){kc=[];Qa=Gl(Qa);for(var uc=Qa.next();!uc.done;uc=Qa.next())if(uc=uc.value,uc.column!==lb.left){var hd=uc.row-1;var ma=uc.column-1;hd=w.DU("EvalFormulaRangeOnClone.cell",$b,hd,ma,hd,ma);ma=uc.text;kc.push(excelOnlineCalc.calc.rangeWrite(hd,excelOnlineCalc.calc.valueCellData(ma,ma,uc.il,null)))}}lb=excelOnlineCalc.calc.cellLocation(lb.top-1,lb.left-1);cb=w.DU("EvalFormulaRangeOnClone.outputColumnRange",
$b,cb.top-1,cb.left-1,cb.bottom-1,cb.right-1);Ha=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(cb,Ha,lb,Jb)];kc=this.Vm.evalOnClonedModel(kc,Ha);this.resumeRecalc();return kc};w.prototype.zEe=function(Qa){var cb=null;try{if(Qa)if(this.xta=va.g(this.Rc).Ea.$ua(Qa),this.currentStateId=Qa.DSa,this.currentStateId<this.fq||this.currentStateId===Y.a.Re)aa.ULS.sendTraceTag(537170176,0,50,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:{0} blockRevision:{1} < lastUpdatedStateId:{2}",this.xta,
this.currentStateId,this.fq);else{if(this.V9h(),!this.RNg()){var lb=String.format("CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:{0} StateId:{1}",this.xta,this.currentStateId);cb=this.Rc.Pb.Gc("ModelUpdate",lb);this.Arb=this.Zvb(Qa.qa.sheetName);if(!this.Arb){var Ha=!!(this.Rc.Qd&32);aa.ULS.sendTraceTag(537170147,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets {0}, scratchPad:{1}, sheetNameLength:{2} Hash:{3}",this.af.yb(this.currentStateId)&&
this.af.oa(this.currentStateId).Hj?this.af.oa(this.currentStateId).Hj.length:0,Ha,Qa.qa.sheetName?Qa.qa.sheetName.length:-1,Qa.qa.hash)}else if(va.g(this.Rc).Ea.um.r1a(Qa.$d)){var $b=Qa.Df;if($b){var Jb=$b.getCalcBlockModel();if(!Jb)aa.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.JNg(Jb)){this.af.oa(this.currentStateId).d_a[this.xta]=new B(Jb,Qa.qa.sheetName);var kc=Qa.Be;kc?this.hBg(kc.NamedObjects):aa.ULS.sendTraceTag(537170144,
0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else aa.ULS.sendTraceTag(537170146,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:{0}",this.xta)}}}else aa.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{cb&&cb.stop()}};w.prototype.g4a=function(Qa){if(!this.af.oa(this.currentStateId).Hj||!this.af.oa(this.currentStateId).Hj[0])return null;var cb=
this.af.oa(this.currentStateId).Hj[0].b6;if(!cb||!cb.yb(Qa.name))return null;cb=cb.oa(Qa.name);if(!cb||!cb.rE)return null;Qa=new R.a;cb=Gl(cb.rE.A$);for(var lb=cb.next();!lb.done;lb=cb.next())Qa.add(lb.value.value);return Qa};w.prototype.getNameLoc=function(Qa,cb){return this.Ngc()?this.af.oa(this.currentStateId).Hj[0].b6.yb(cb)?(Qa=excelOnlineCalc.location.nameLoc(Qa,cb),excelOnlineCalc.util.success(Qa)):excelOnlineCalc.util.success(null):(Qa=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Qa))};
w.prototype.getContainingTable=function(Qa){if(!this.Ngc())return Qa=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Qa);var cb=Qa.range.col,lb=Qa.range.row,Ha=this.af.oa(this.currentStateId).Hj[0].b6,$b=null;Ha=Gl(Ha);for(var Jb=Ha.next();!Jb.done;Jb=Ha.next())if(Jb=Jb.value.value,2===Jb.type&&tb.a.equals(Qa.sheet.index.toString(),Jb.sheetId,!0)){var kc=Jb.range;cb>=kc.left-1&&cb<=kc.right-1&&lb<=kc.bottom-1&&lb>=kc.top-1&&($b=excelOnlineCalc.location.nameScope(this.documentLoc,
Jb.sheetId),$b=excelOnlineCalc.location.nameLoc($b,Jb.fullName))}return $b?excelOnlineCalc.util.success($b):excelOnlineCalc.util.success(null)};w.prototype.getStructRefColumn=function(Qa,cb){if(!this.Ngc()){var lb=excelOnlineCalc.util.unavailable([2]);return excelOnlineCalc.util.failure(lb)}lb=Qa.name;var Ha=this.af.oa(this.currentStateId).Hj[0].b6;if(Ha.yb(lb)){Ha=Ha.oa(lb);var $b=Ha.range;if(2!==Ha.type)return excelOnlineCalc.util.failure(this.t3c(5));var Jb=Ha.rE?Ha.rE.A$:null;if(!Jb)return excelOnlineCalc.util.success(null);
for(var kc=Gl(Jb),uc=kc.next();!uc.done;uc=kc.next())if(uc=uc.value,tb.a.equals(uc.value,cb,!0))return Qa=excelOnlineCalc.location.documentLoc(Qa.scope.document.path,Qa.scope.document.name),Qa=excelOnlineCalc.location.sheetIndex(Qa,Ha.sheetId),$b=excelOnlineCalc.location.gridRange($b.top-1,uc.key,$b.bottom-$b.top+1,1),$b=excelOnlineCalc.location.sheetGridRange(Qa,$b),lb=excelOnlineCalc.location.structRefColumnLoc(lb,$b,!!(Ha.attributes&16),!!(Ha.attributes&8)),excelOnlineCalc.util.success(lb);return $b.right-
$b.left+1!==Jb.count?(lb=excelOnlineCalc.util.unavailable([17,Qa,cb]),excelOnlineCalc.util.failure(lb)):excelOnlineCalc.util.failure(this.t3c(0))}return excelOnlineCalc.util.success(null)};w.prototype.getStructRefSpecialRef=function(Qa,cb){if(!this.Ngc())return cb=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(cb);var lb=this.af.oa(this.currentStateId).Hj[0].b6;if(lb.yb(Qa.name)){var Ha=lb.oa(Qa.name);if(2!==Ha.type)return excelOnlineCalc.util.failure(this.t3c(5));lb=!!(Ha.attributes&
16);var $b=!!(Ha.attributes&8),Jb=lb?1:0,kc=$b?1:0;Qa=excelOnlineCalc.location.documentLoc(Qa.scope.document.path,Qa.scope.document.name);Qa=excelOnlineCalc.location.sheetIndex(Qa,Ha.sheetId);Ha=Ha.range;var uc={};if(1===cb)uc=excelOnlineCalc.location.gridRange(Ha.top-Jb-1,Ha.left-1,Ha.bottom+kc-Ha.top+Jb+1,Ha.right-Ha.left+1);else if(2===cb)uc=excelOnlineCalc.location.gridRange(Ha.top-1,Ha.left-1,Ha.bottom-Ha.top+1,Ha.right-Ha.left+1);else if(3===cb)if(lb)uc=excelOnlineCalc.location.gridRange(Ha.top-
2,Ha.left-1,1,Ha.right-Ha.left+1);else return excelOnlineCalc.util.success(null);else if(4===cb)if($b)uc=excelOnlineCalc.location.gridRange(Ha.bottom,Ha.left-1,1,Ha.right-Ha.left+1);else return excelOnlineCalc.util.success(null);cb=excelOnlineCalc.location.sheetGridRange(Qa,uc);return excelOnlineCalc.util.success(cb)}return excelOnlineCalc.util.success(null)};w.prototype.getDocumentLoc=function(Qa,cb){if((tb.a.equals(Qa,this.documentLoc.path,!0)||!Qa)&&tb.a.equals(cb,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);
Qa=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(Qa,cb)]);return excelOnlineCalc.util.failure(Qa)};w.prototype.getSheetIndex=function(Qa,cb){if(!this.af.yb(this.currentStateId)||!this.af.oa(this.currentStateId).Hj)return cb=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(cb);Qa=this.af.oa(this.currentStateId).Hj;for(var lb=1;lb<Qa.length;lb++)if(tb.a.equals(Qa[lb].x7.sheetName,cb,!0))return excelOnlineCalc.util.success(Qa[lb].x7.sheetId);return excelOnlineCalc.util.success(null)};
w.prototype.getSheetName=function(Qa,cb){if(!this.af.yb(this.currentStateId)||!this.af.oa(this.currentStateId).Hj)return cb=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(cb);Qa=this.af.oa(this.currentStateId).Hj;for(var lb=1;lb<Qa.length;lb++)if(tb.a.equals(Qa[lb].x7.sheetId,cb,!0))return excelOnlineCalc.util.success(Qa[lb].x7.sheetName);return excelOnlineCalc.util.success(null)};w.prototype.getUserDefinedFuncLoc=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"])};
w.prototype.getSheetRangeIndexes=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"])};w.prototype.OSg=function(Qa,cb,lb){var Ha=va.g(this.Rc),$b=Ha.lc(cb);$b=this.ZYd($b,null,"CopyPaste");lb=this.ZYd(Ha.lc(Qa),lb,"CopyPaste");if(0>$b||0>lb||$b!==lb)aa.ULS.sendTraceTag(537170143,0,15,"CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:{0}, targetRevision:{1}.",lb,$b);else{lb=[];Ha=nc.d(this.Rc.xa.qa);
var Jb=this.Sgd(Ha);Qa=w.DU("CalculateFormulaForCopyPaste.srcRange",Ha,Qa.top-1,Qa.left-1,Qa.bottom-1,Qa.right-1);cb=w.DU("CalculateFormulaForCopyPaste.targetRange",Ha,cb.top-1,cb.left-1,cb.bottom-1,cb.right-1);cb=excelOnlineCalc.calc.copyPasteRangePasteEdit(cb,Qa,Jb);lb.push(cb);cb=Jb?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Ha,$b,Jb.row,Jb.column,Jb.lastRow,Jb.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",
Ha,$b,"","","","");aa.ULS.sendTraceTag(537170142,0,50,cb);this.Vm.editRangePaste($b,lb);this.resumeRecalc()}};w.prototype.Sgd=function(Qa){var cb=this.b3e(),lb=null;cb?lb=w.DU("GetViewport.viewport",Qa,cb.top-1,cb.left-1,cb.bottom-1,cb.right-1):aa.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return lb};w.prototype.b3e=function(){var Qa=va.g(this.Rc),cb=Qa.Gh;if(va.g(this.Rc).rb.$i){cb=Qa.Uf(1).Gh;if(Ia.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&
!cb)return aa.ULS.sendTraceTag(537170140,0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;cb.Ana(1,1);cb.Ana(3,1)}return cb};w.prototype.ZYd=function(Qa,cb,lb){if(!this.Vm||!Qa)return aa.ULS.sendTraceTag(537170139,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:{0}, modifiedCell is null:{1}, operation:{2}",!this.Vm,!Qa,lb),-1;var Ha=Qa.cell.cK-1,$b=Qa.cell.bK-1;if(Qa.cell.cu){var Jb=Qa.cell.cu.bYc;if(Jb===Y.a.Re)return aa.ULS.sendTraceTag(537170138,
0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:{0}, operation:{1}",Qa.cell.cu.$d,lb),-1}else return aa.ULS.sendTraceTag(537170137,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:({0},{1}), operation:{2}",Qa.cell.cK,Qa.cell.bK,lb),-1;if(Jb<this.fq)return aa.ULS.sendTraceTag(537170136,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}, operation:{4}",
Ha,$b,Jb,this.fq,lb),-1;if(Jb<this.currentStateId)return aa.ULS.sendTraceTag(537170135,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}, operation:{4}",Ha,$b,Jb,this.currentStateId,lb),-1;cb&&!this.HEb&&(this.Vm.setOnRecalcResults(cb),this.HEb=!0);return this.Lag()&&!this.Keb(2)?(aa.ULS.sendTraceTag(537170134,0,15,"CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:{0}",lb),-1):Jb};w.prototype.getFormulaBarText=
function(Qa,cb,lb){return cb&&cb.startsWith("'")?cb:Qa.cell.formulaBarText||lb.toString()};w.prototype.v8g=function(Qa,cb,lb){var Ha=null;if(this.yve()&&this.af.oa(this.fq).d_a){var $b=this.af.oa(this.fq).d_a[Qa];if(null===$b||void 0===$b?0:$b.nvc)Ha=$b.Que}lb=this.Idi(Ha,cb,lb);cb=this.F_g(Ha,cb,lb);aa.ULS.sendTraceTag(50671754,0,50,"CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:{0} StateId:{1} number of formulas {2}",Qa,this.currentStateId,cb)};w.prototype.Idi=function(Qa,
cb,lb){var Ha=!1,$b=w.yWe(cb);if(Qa){var Jb=w.yWe(Qa);tb.a.equals(Jb,$b,!1)&&(Ha=!0)}Ha?this.KBg(Qa,this.fq,lb):this.MBg(cb,lb);return Ha};w.prototype.yve=function(){var Qa=!1;this.Vm&&-1!==this.fq&&(Qa=this.Vm.stateIdAvailable(this.fq));return Qa&&this.af.yb(this.fq)&&this.fq<this.currentStateId};w.prototype.F_g=function(Qa,cb,lb){var Ha=0;var $b,Jb;for(cb.reset();$b=cb.getNextCell();)la.e($b.formula)&&Ha++,(Jb=lb?Qa.getCell($b.row,$b.col):null)?this.B_g(cb,$b,Jb):this.LBg(cb,$b);if(lb)for(Qa.reset();Jb=
Qa.getNextCell();)($b=cb.getCell(Jb.row,Jb.col))||this.ule(Qa,Jb);return Ha};w.prototype.Ppj=function(){this.Vm.setOnUpdateRequest(function(){})};w.prototype.Opj=function(){var Qa=this;this.Vm.setOnUnresponsive(function(cb,lb,Ha,$b){Qa.XRi(cb,lb,Ha,$b)})};w.prototype.XRi=function(Qa,cb,lb,Ha){aa.ULS.sendTraceTag(537170126,0,15,"CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:{0}, waitTime:{1}, timeoutCount:{2}, hasBeenClosed:{3}.",Qa,cb,lb,Ha);Ha&&(this.Pej(),this.Boa())};
w.prototype.Pej=function(){this.vd(null,null);this.dtd=this.HEb=!1;this.wEd=0;this.mEd=this.oEd=this.pEd=this.nEd=-1};w.prototype.close=function(){this.Vm.close()};w.prototype.clearCache=function(){this.Vm.clearCache()};w.prototype.resumeRecalc=function(){this.Vm.resumeRecalc()};w.prototype.cpj=function(){this.Vm.setA1ReferenceStyle(!0)};w.prototype.K4i=function(){if(this.instantaneousSupportInformationManager){var Qa=this.instantaneousSupportInformationManager.abi,cb=this.instantaneousSupportInformationManager.dbi,
lb=this.instantaneousSupportInformationManager.cbi,Ha=this.instantaneousSupportInformationManager.bbi,$b=!1;Qa!==this.nEd&&($b=!0,this.nEd=Qa);cb!==this.pEd&&($b=!0,this.pEd=cb);lb!==this.oEd&&($b=!0,this.oEd=lb);Ha!==this.mEd&&($b=!0,this.mEd=Ha);var Jb=[];Ia.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",!1)&&($b=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),Jb.push($b),$b=!0);Ia.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",
!1)&&($b=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),Jb.push($b),$b=!0);Ia.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&($b=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",null),Jb.push($b),$b=!0);$b&&(Qa=excelOnlineCalc.calc.recalcServiceConfig(null,Qa,null,cb,null,null,null,lb,Jb,Ha),this.Vm.reconfigure(Qa))}};w.prototype.Mrj=function(Qa){var cb=this,lb=null;if(this.af.yb(this.currentStateId))try{this.S$=[];var Ha=
String.format("CalcAsyncEngine::SetUpdatedRanges() StateId:{0} UpdateTriggerData:{1}",this.currentStateId,cc[Qa]);lb=this.Rc.Pb.Gc("ModelUpdate",Ha);Pa.a.forEach(this.af.oa(this.currentStateId).d_a,function($b,Jb){Jb.nvc||(cb.v8g($b,Jb.Que,Jb.sheetName),Jb.nvc=!0)},null);this.Vm.updateRanges(this.currentStateId,this.S$)}finally{lb&&lb.stop()}else aa.ULS.sendTraceTag(537170122,0,15,"CalcAsyncEngine::SetUpdatedRanges StateId:{0} does not exist in GridCache",this.currentStateId)};w.prototype.Lrj=function(){var Qa=
[],cb=this.yve(),lb=cb&&this.af.oa(this.fq).Hj&&this.af.oa(this.fq).Hj[0]&&this.af.oa(this.fq).Hj[0].Blc?this.af.oa(this.fq).Hj[0].b6:null;this.gAe(lb,this.af.oa(this.currentStateId).Hj[0].b6,null,this.fq,Qa);this.af.oa(this.currentStateId).Hj[0].Blc=!0;for(var Ha=1;Ha<this.af.oa(this.currentStateId).Hj.length;Ha++)lb=-1,cb&&this.af.oa(this.fq).Hj&&(lb=this.agd(this.af.oa(this.currentStateId).Hj[Ha].x7.sheetName,this.fq)),lb=-1!==lb&&this.af.oa(this.fq).Hj[lb].Blc?this.af.oa(this.fq).Hj[lb].b6:null,
this.gAe(lb,this.af.oa(this.currentStateId).Hj[Ha].b6,this.af.oa(this.currentStateId).Hj[Ha].x7.sheetId,this.fq,Qa),this.af.oa(this.currentStateId).Hj[Ha].Blc=!0;this.Vm.updateNamedObjects(this.currentStateId,Qa)};w.prototype.gAe=function(Qa,cb,lb,Ha,$b){if(void 0!==lb&&null!==lb){var Jb=excelOnlineCalc.calc.undefinedNamesWrite(lb);$b.push(Jb)}if(Qa){var kc=!1,uc=[];Jb=[];if(cb)for(var hd=Gl(cb),ma=hd.next();!ma.done;ma=hd.next()){ma=ma.value;var jb=ma.value;if(Qa.yb(ma.key)){var Zb=Qa.oa(ma.key);
w.OBi(Zb,jb)?kc=!0:(Zb=excelOnlineCalc.calc.namedObject(ma.key,null),uc.push(Zb),w.lUc(ma.key,jb,Jb))}else w.lUc(ma.key,jb,Jb)}Qa=Gl(Qa);for(ma=Qa.next();!ma.done;ma=Qa.next())hd=ma.value,cb&&cb.yb(hd.key)||(hd=excelOnlineCalc.calc.namedObject(hd.key,null),uc.push(hd));kc&&(cb=excelOnlineCalc.calc.namedObjectsPromote(lb,Ha),$b.push(cb));0<uc.length&&(cb=excelOnlineCalc.calc.namedObjectsWrite(lb,uc),$b.push(cb));0<Jb.length&&(lb=excelOnlineCalc.calc.namedObjectsWrite(lb,Jb),$b.push(lb))}else if(cb){Jb=
[];cb=Gl(cb);for(Ha=cb.next();!Ha.done;Ha=cb.next())Ha=Ha.value,w.lUc(Ha.key,Ha.value,Jb);0<Jb.length&&(lb=excelOnlineCalc.calc.namedObjectsWrite(lb,Jb),$b.push(lb))}};w.prototype.RNg=function(){return this.af.oa(this.currentStateId).d_a[this.xta]?(aa.ULS.sendTraceTag(537170121,0,50,"CalcAsyncEngine::BlockPreviouslyHandled Block Hash:{0} StateId:{1} previously handled",this.xta,this.currentStateId),!0):!1};w.prototype.JNg=function(Qa){return 1===Qa.getColumnNumbers().length&&Qa.getColumnNumbers()[0]===
w.wvd+1?!1:!0};w.prototype.Q9h=function(){var Qa=this,cb=!1;va.g(this.Rc).Ea.Uad(function(lb){lb.state&1&&Qa.Rc.ea.Te===lb.qe.Revision&&(Qa.zEe(lb),cb=!0)});return cb};w.prototype.wCe=function(Qa,cb){var lb=Qa.getRowNumbers(),Ha=Qa.getColumnNumbers();Qa=lb[0]-1;lb=lb[lb.length-1]-1;var $b=Ha[0]-1;Ha=Ha[Ha.length-1]-1;(cb=this.Zvb(cb))||aa.ULS.sendTraceTag(537170120,0,15,"CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets {0}",this.af.yb(this.currentStateId)&&
this.af.oa(this.currentStateId).Hj?this.af.oa(this.currentStateId).Hj.length:0);return w.DU("CreateBlockRangeLocation",cb,Qa,$b,lb,Ha)};w.prototype.KBg=function(Qa,cb,lb){if(lb=this.wCe(Qa,lb)){var Ha=w.t4b(Qa.getRowNumbers());Qa=w.t4b(Qa.getColumnNumbers());cb=excelOnlineCalc.calc.rangePromote(lb,cb,Ha,Qa);this.S$[this.S$.length]=cb}};w.prototype.MBg=function(Qa,cb){if(cb=this.wCe(Qa,cb)){var lb=w.t4b(Qa.getRowNumbers());Qa=w.t4b(Qa.getColumnNumbers());Qa=excelOnlineCalc.calc.rangeWrite(cb,null,
lb,Qa);this.S$[this.S$.length]=Qa}};w.prototype.B_g=function(Qa,cb,lb){var Ha=null,$b=0,Jb=0;switch(cb.valueType){case 2:Ha=this.Pgd(cb);var kc=this.Pgd(lb);kc=tb.a.equals(kc,Ha,!1);break;case 1:null===cb.value&&null===lb.value?kc=!0:($b=parseFloat(cb.value),kc=parseFloat(lb.value)===$b);break;default:null===cb.value&&null===lb.value?kc=!0:(Jb=parseFloat(cb.value),kc=Jb===parseFloat(lb.value))}kc&&cb.valueType===lb.valueType&&cb.ifmt===lb.ifmt&&cb.formulaType===lb.formulaType&&tb.a.equals(lb.formula,
cb.formula,!1)||(void 0!==cb.formula&&null!==cb.formula||void 0!==cb.value&&null!==cb.value||void 0!==cb.text&&null!==cb.text?this.NYb(Qa,cb,Ha,$b,Jb):this.ule(Qa,cb))};w.prototype.hBg=function(Qa){if(this.Rc.Hb&&this.Rc.Hb.items)for(var cb=0;cb<this.Rc.Hb.count;cb++){var lb=this.Rc.Hb.items[cb];if(2===lb.type||3===lb.type){var Ha=0,$b=lb.name,Jb=$b.lastIndexOf("!");if(0<Jb){Ha=$b.substr(0,Jb);"'"===Ha.charAt(0)&&(Ha=Ha.substr(1,Ha.length-2));Ha=this.agd(Ha,this.currentStateId);if(-1===Ha){aa.ULS.sendTraceTag(595096334,
0,15,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.af.yb(this.currentStateId)&&this.af.oa(this.currentStateId).Hj?this.af.oa(this.currentStateId).Hj.length:0);continue}$b=$b.substr(Jb+1)}Ha=this.af.oa(this.currentStateId).Hj[Ha].b6;var kc=lb.usedRange;2===lb.type&&(kc=db.a(lb));if(Ha.yb($b)){if(Jb=Ha.oa($b),Jb.range=kc,Jb.attributes=lb.attributes,2===Jb.type&&($b=w.ESe(lb.name,Qa),lb=(Ha=Ia.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc"))?
lb.DO:null===$b||void 0===$b?void 0:$b.ColHeadersList,$b||Ha))if(!Jb.rE)Jb.rE=new v(lb);else if(lb)for(lb=Gl(lb.HeadersList),$b=lb.next();!$b.done;$b=lb.next())$b=$b.value,Jb.rE.A$.ia($b.Index,$b.Name)}else if(Jb=this.Zvb(lb.sheetName)){Jb=new A(lb.type,lb.name,kc,Jb,lb.attributes);if(2===Jb.type)if(Ia.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc")&&lb.DO)Jb.rE=new v(lb.DO);else if(lb=w.ESe(lb.name,Qa))Jb.rE=new v(lb.ColHeadersList);Ha.ia($b,Jb)}else aa.ULS.sendTraceTag(537170117,
0,50,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.af.yb(this.currentStateId)&&this.af.oa(this.currentStateId).Hj?this.af.oa(this.currentStateId).Hj.length:0)}}};w.prototype.NYb=function(Qa,cb,lb,Ha,$b){var Jb=Qa.getRowNumbers()[cb.row]-1;Qa=Qa.getColumnNumbers()[cb.col]-1;Jb=w.DU("AddRangeUpdateCommand",this.Arb,Jb,Qa,Jb,Qa);Qa=null;var kc=cb.formula||cb.text,uc=excelOnlineCalc.calc.blankValue,hd=null;void 0!==cb.text&&null!==cb.text||void 0!==
cb.value&&null!==cb.value||(lb="",hd="This cell contains blanks only",0===cb.formulaType&&(kc=""));switch(cb.valueType){case 2:null!==lb&&(0===cb.formulaType&&(Qa=excelOnlineCalc.calc.valueCellData(kc,lb,cb.ifmt,hd)),1===cb.formulaType&&(Qa=excelOnlineCalc.calc.cellFormulaCellData(kc,lb,cb.ifmt,hd)),2===cb.formulaType&&(Qa=excelOnlineCalc.calc.valueCellData("",uc,0,"This cell is a part of an array")));break;case 1:isNaN(Ha)?aa.ULS.sendTraceTag(537170116,0,50,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid numeric value",
cb.row,cb.col):(0===cb.formulaType&&(Qa=excelOnlineCalc.calc.valueCellData(kc,Ha,cb.ifmt,null)),1===cb.formulaType&&(Qa=excelOnlineCalc.calc.cellFormulaCellData(kc,Ha,cb.ifmt,null)),2===cb.formulaType&&(Qa=excelOnlineCalc.calc.valueCellData("",uc,0,"This cell is a part of an array")));break;case 3:isNaN($b)?aa.ULS.sendTraceTag(537170115,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid boolean value",cb.row,cb.col):(lb=1===$b?!0:!1,0===cb.formulaType&&(Qa=excelOnlineCalc.calc.valueCellData(kc,
lb,cb.ifmt,null)),1===cb.formulaType&&(Qa=excelOnlineCalc.calc.cellFormulaCellData(kc,lb,cb.ifmt,null)),2===cb.formulaType&&(Qa=excelOnlineCalc.calc.valueCellData("",uc,0,"This cell is a part of an array")));break;case 4:isNaN($b)?aa.ULS.sendTraceTag(537170114,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid error value",cb.row,cb.col):(lb=excelOnlineCalc.calc.errorValue($b),0===cb.formulaType&&(Qa=excelOnlineCalc.calc.valueCellData(kc,lb,cb.ifmt,null)),1===cb.formulaType&&(Qa=excelOnlineCalc.calc.cellFormulaCellData(kc,
lb,cb.ifmt,null)),2===cb.formulaType&&(Qa=excelOnlineCalc.calc.valueCellData("",uc,0,"This cell is a part of an array")));break;default:Qa=excelOnlineCalc.calc.valueCellData("",uc,cb.ifmt,null)}Qa&&(cb=excelOnlineCalc.calc.rangeWrite(Jb,Qa,null,null),this.S$[this.S$.length]=cb)};w.prototype.LBg=function(Qa,cb){switch(cb.valueType){case 2:this.NYb(Qa,cb,this.Pgd(cb),null,0);break;case 1:this.NYb(Qa,cb,null,parseFloat(cb.value),0);break;default:this.NYb(Qa,cb,null,null,parseFloat(cb.value))}};w.prototype.ule=
function(Qa,cb){var lb=Qa.getRowNumbers()[cb.row]-1;Qa=Qa.getColumnNumbers()[cb.col]-1;lb=w.DU("AddRangeUpdateCommandEmptyCell",this.Arb,lb,Qa,lb,Qa);cb=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,cb.ifmt,null);cb=excelOnlineCalc.calc.rangeWrite(lb,cb,null,null);this.S$[this.S$.length]=cb};w.prototype.Zvb=function(Qa){Qa=this.agd(Qa,this.currentStateId);return 0<Qa?this.af.oa(this.currentStateId).Hj[Qa].x7.sheetId:null};w.prototype.agd=function(Qa,cb){if(!this.af.yb(cb))return aa.ULS.sendTraceTag(537170113,
0,15,"CalcAsyncEngine.GetSheetInternalIndex StateId:{0} does not exist in GridCache",cb),-1;var lb=this.af.oa(cb);return lb.Hj?lb.getSheetIndex(Qa):(aa.ULS.sendTraceTag(537170112,0,15,"CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:{0}",cb),-1)};w.prototype.irj=function(){if(!this.af.yb(this.currentStateId)||!this.af.oa(this.currentStateId).Hj.length)return aa.ULS.sendTraceTag(537170083,0,15,"CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:{0} or StateId does not exist in GridCache",
this.currentStateId),!1;for(var Qa=[],cb=1;cb<this.af.oa(this.currentStateId).Hj.length;cb++){var lb=this.af.oa(this.currentStateId).Hj[cb];lb&&Qa.push(lb.x7)}this.Vm.updateSheetNames(this.currentStateId,Qa);this.Vm.updateUnusedCells(this.currentStateId,this.af.oa(this.currentStateId).Yag);return!0};w.prototype.setNumberFormats=function(){if(this.instantaneousSupportInformationManager){for(var Qa=[],cb=Gl(this.instantaneousSupportInformationManager.dya),lb=cb.next();!lb.done;lb=cb.next())lb=lb.value,
lb=excelOnlineCalc.calc.numberFormat(lb.IfmtIndex,lb.FormatString,lb.Builtin),Qa.push(lb);this.Vm.setNumberFormats(Qa,!0)}};w.prototype.Jnj=function(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Me){var Qa=this.T9h();if(!this.dtd||Qa)this.s4b(),this.instantaneousSupportInformationManager.Me.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.Me.TrueValueString),this.instantaneousSupportInformationManager.Me.FalseValueString&&
(this.falseName=this.instantaneousSupportInformationManager.Me.FalseValueString),Qa=Cb.CalcHelper.qDe(this.instantaneousSupportInformationManager,Qa),this.Vm.setLocale(Qa),this.dtd=!0}};w.prototype.Xrj=function(){var Qa=null;if(void 0!==this.Rc.workbookContext.TimeZoneInformation&&null!==this.Rc.workbookContext.TimeZoneInformation){Qa=null;this.Rc.workbookContext.TimeZoneInformation.StandardDate.Month&&(Qa=excelOnlineCalc.date.dateTime(this.Rc.workbookContext.TimeZoneInformation.StandardDate.Year,
this.Rc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Rc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Rc.workbookContext.TimeZoneInformation.StandardDate.Hour,this.Rc.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Rc.workbookContext.TimeZoneInformation.StandardDate.Second,this.Rc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Rc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));var cb=null;this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Month&&
(cb=excelOnlineCalc.date.dateTime(this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Month,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Hour,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,
3));Qa=excelOnlineCalc.date.tzData(this.Rc.workbookContext.TimeZoneInformation.Bias,Qa,this.Rc.workbookContext.TimeZoneInformation.StandardBias,cb,this.Rc.workbookContext.TimeZoneInformation.DaylightBias)}else aa.ULS.sendTraceTag(537170082,0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");Qa=excelOnlineCalc.calc.workbookProps(this.Rc.workbookContext.F1904,this.Rc.workbookContext.FDateCompatibility,Qa);this.Vm.setWorkbookProps(Qa)};w.prototype.Boa=function(){var Qa=this;Ia.EwaSettings.ma(306)&&
zc.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.n4f,!0)).continueWith(function($b){$b.exception?aa.ULS.sendTraceTag(537170079,0,15,"CalcAsyncEngine.TryInitialize: calc smoke test failed: {0}",$b.exception.toString()):aa.ULS.sendTraceTag(537170080,0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});var cb=Ia.EwaSettings.ma(656)?t.local:t.WGj,lb=Gl(nb.a.OV()?[excelOnlineCalc.x10.PluginSchedulerSingleton.instance(),excelOnlineCalc.x10.GridImportManagerSingleton.instance()]:
[void 0,void 0]),Ha=lb.next().value;lb=lb.next().value;this.xGd=zc.c(excelOnlineCalc.calc.createRecalcService(cb,Ha,lb));this.xGd.continueWith(function($b){$b.exception?aa.ULS.sendTraceTag(537170075,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker failed: {0}",$b.exception.toString()):(aa.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),Qa.Vm=Qa.xGd.result,Qa.Vm?Qa.Keb(0)?Qa.Opj():aa.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):
aa.ULS.sendTraceTag(537170076,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})};w.prototype.T9h=function(){var Qa=this.instantaneousSupportInformationManager.ija;if(!Qa||this.wEd===Qa.length)return null;this.wEd=Qa.length;return Cb.CalcHelper.dDe(Qa)};w.prototype.s4b=function(){this.errorTypeNames=Cb.CalcHelper.s4b()};w.prototype.V9h=function(){if(!(this.af.yb(this.currentStateId)&&0<this.af.oa(this.currentStateId).Hj.length)){this.af.ia(this.currentStateId,new D(this.$nd));
this.af.oa(this.currentStateId).YZf(0,new z(null));for(var Qa=this.Rc.xa,cb=0;cb<Qa.count;cb++){var lb=Object(Da.a)(Bb.a,Qa.getItem(cb));if(lb){void 0!==lb.sheetId&&null!==lb.sheetId&&void 0!==lb.name&&null!==lb.name&&lb.sheetId.length&&lb.sheetName.length||aa.ULS.sendTraceTag(537170074,0,15,"CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:{0} Id:{1} Hash:{2} NameLength:{3}",cb,lb.sheetId,lb.hash,lb.name?lb.name.length:-1);var Ha=excelOnlineCalc.calc.sheetName(lb.sheetId,lb.name);
this.af.oa(this.currentStateId).YZf(cb+1,new z(Ha));Ha=lb.usedRange.DS();Ha=excelOnlineCalc.calc.rangeLocation(0,0,Ha.LastRow,Ha.LastColumn);lb=excelOnlineCalc.calc.unusedCellsUpdate(lb.sheetId,Ha);Array.add(this.af.oa(this.currentStateId).Yag,lb)}else aa.ULS.sendTraceTag(537170073,0,15,"CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:{0} sheet-index:{1}",this.currentStateId,cb)}}};w.prototype.cXg=function(){for(var Qa=Gl(this.af),cb=Qa.next();!cb.done;cb=Qa.next())cb=cb.value,
cb.key<this.fq&&this.af.remove(cb.key)};w.prototype.Pgd=function(Qa){Qa=Qa.value||Qa.text;if(void 0===Qa||null===Qa)Qa="";return Qa};w.prototype.Lag=function(){if(!this.af.yb(this.currentStateId))return!1;var Qa=!1;Pa.a.forEach(this.af.oa(this.currentStateId).d_a,function(cb,lb){lb.nvc||(Qa=!0)},null);return Qa};w.prototype.t3c=function(Qa){var cb={};cb.reason=Qa;cb.kind=1;return cb};w.prototype.Ngc=function(){return this.af.yb(this.currentStateId)&&this.af.oa(this.currentStateId).Hj&&this.af.oa(this.currentStateId).Hj[0]&&
this.af.oa(this.currentStateId).Hj[0].b6?!0:!1};w.z4g=function(Qa){var cb=[];if(null===Qa||void 0===Qa?0:Qa.A$){Qa=Gl(Qa.A$);for(var lb=Qa.next();!lb.done;lb=Qa.next())lb=lb.value,lb=excelOnlineCalc.calc.columnData(lb.key,lb.value),cb.push(lb)}return cb};w.OBi=function(Qa,cb){if(Qa.type!==cb.type||Qa.attributes!==cb.attributes||!tb.a.equals(Qa.fullName,cb.fullName,!1)||!Qa.range.equals(cb.range))return!1;if(!Qa.rE&&!cb.rE)return!0;if(!Qa.rE||!cb.rE||Qa.rE.A$.count!==cb.rE.A$.count)return!1;var lb=
{};Qa=Gl(Qa.rE.A$);for(var Ha=Qa.next();!Ha.done;lb={Sfb:lb.Sfb,Zfb:lb.Zfb},Ha=Qa.next())if(lb.Sfb=Ha.value,lb.Zfb=void 0,!(lb.Sfb.value&&function($b){return function(){var Jb=cb.rE.A$.Nc($b.Sfb.key);$b.Zfb=Jb.value;return Jb}}(lb)().returnValue&&lb.Zfb&&tb.a.equals(lb.Sfb.value,lb.Zfb,!1)))return!1;return!0};w.lUc=function(Qa,cb,lb){var Ha=w.DU("NamedObject",cb.sheetId,cb.range.top-1,cb.range.left-1,cb.range.bottom-1,cb.range.right-1);if(2===cb.type){var $b=!!(cb.attributes&16),Jb=!!(cb.attributes&
8);cb=w.z4g(cb.rE);Ha=excelOnlineCalc.calc.namedTableData(Ha,$b,Jb,cb);Qa=excelOnlineCalc.calc.namedObject(Qa,Ha)}else Ha=excelOnlineCalc.calc.namedRangeData(Ha),Qa=excelOnlineCalc.calc.namedObject(Qa,Ha);lb.push(Qa)};w.yWe=function(Qa){var cb=Sys.Serialization.JavaScriptSerializer.serialize(Qa.getRowNumbers());Qa=Sys.Serialization.JavaScriptSerializer.serialize(Qa.getColumnNumbers());return cb+Qa};w.t4b=function(Qa){var cb=null;if(1<Qa.length)for(var lb=1;lb<Qa.length;lb++)for(var Ha=0;Qa[lb-1]+
1+Ha<Qa[lb];)cb=cb||[],cb.push(Qa[lb-1]+Ha),Ha++;return cb};w.ESe=function(Qa,cb){if(!cb)return null;for(var lb=0,Ha=cb.length;lb<Ha;++lb)if(tb.a.equals(Qa,cb[lb].Name,!1))return cb[lb];return null};w.DU=function(Qa,cb,lb,Ha,$b,Jb){function kc(uc,hd,ma,jb){(0>ma||ma>=jb)&&aa.ULS.sendTraceTag(537170072,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} invalid {1}:{2}",uc,hd,ma)}void 0!==cb&&null!==cb||aa.ULS.sendTraceTag(537170071,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} sheetId is null",
Qa);kc(Qa,"top",lb,w.Iof);kc(Qa,"left",Ha,w.wvd);kc(Qa,"bottom",$b,w.Iof);kc(Qa,"right",Jb,w.wvd);return excelOnlineCalc.calc.sheetRangeLocation(cb,lb,Ha,$b,Jb)};w.Iof=1048576;w.wvd=16384;Object(C.a)(w,"CalcAsyncEngine",null,[3]);Object(C.a)(u,"AbsoluteRelativeReferenceInfo",null,[]);var Eb=b(1180),Ja=b(25);x.IGf="#";Object(C.a)(x,"Operators",null,[]);var Rb=b(1181);h.sheet="Sheet";h.sheetRange="SheetRange";h.document="Document";h.A6h="Ident";Object(C.a)(h,"TraverseFormulaQualifierTypes",null,[]);
var yc=b(1182),qd=b(1083),bc=b(998),Vb=b(58),mc=b(62),sb=b(564);m.prototype.dispose=function(){var Qa=this;aa.ULS.sendTraceTag(537170064,0,50,"CalcManager.Dispose called");this.$.da.$a(268,function(cb){cb.JId(Qa.ync);cb.AId(Qa.enc)});this.gridView&&(this.gridView.Ww(this.onContentReady),this.gridView.Ea&&this.gridView.Ea.POf(this.Btf),this.fr=null);this.PFc=null};m.prototype.QSg=function(Qa,cb,lb,Ha){Ha=void 0===Ha?null:Ha;this.Hl&&(Ia.EwaSettings.isChangeGateEnabled("OfficeVSO:5470583_Calculate_Formula_Refactoring")?
this.Hl.NSg(Qa,cb,lb,Ha):this.Hl.PSg(Qa,cb,lb,Ha))};m.prototype.evalFormula=function(Qa){return this.Hl?this.Hl.evalFormula(Qa):Promise.reject("calc engine not initialized")};m.prototype.evalFormulaRange=function(Qa,cb,lb){return this.Hl?this.Hl.evalFormulaRange(Qa,cb,lb):Promise.reject("calc engine not initialized")};m.prototype.atb=function(Qa,cb,lb,Ha){return this.Hl?this.Hl.atb(Qa,cb,lb,Ha):Promise.reject("CalcEngine is null")};m.prototype.g4a=function(Qa){return this.Hl?(aa.ULS.shipAssertTag(537170059,
0,2===Qa.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),this.Hl.g4a(Qa)):null};m.prototype.lIg=function(Qa,cb){if(!cb||2!==Qa.type)return!1;Qa=db.a(Qa);return Qa.right-Qa.left+1===cb.count};m.prototype.kRe=function(Qa){if(!this.DFb)return this.ffg||aa.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var cb=this.kta(Ja.Range.hd(1,1));cb=this.DFb.parseFormula(excelOnlineCalc.parse.parseLocals(1,cb.range),Qa);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(cb))return aa.ULS.sendTraceTag(537170056,
0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{if(Ia.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesHighlighting",!1)){var lb=this.gridView.ha.ta.activeCell,Ha=excelOnlineCalc.location.gridCell(lb.top-1,lb.left-1),$b=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),Jb=excelOnlineCalc.location.sheetIndex($b,this.$.xa.qa.sheetId),kc=this.R8g(Ha,Jb);this.JKd||(this.JKd=excelOnlineCalc.util.createResolver(this.Q8g()));
var uc=excelOnlineCalc.parse.parseResultHelper.extractReferences(cb,this.Pr.config.localeInfo,Ia.EwaSettings.ma(597),kc,this.JKd)}else uc=excelOnlineCalc.parse.parseResultHelper.extractReferences(cb,this.Pr.config.localeInfo,Ia.EwaSettings.ma(597));Ia.EwaSettings.ma(103)&&this.VQj(uc,Qa);return uc}catch(hd){return aa.ULS.sendTraceTag(537170055,0,10,"CalcManager.ExtractReferenceWrappers - exception: {0}",hd.message),null}};m.prototype.extractLetVariables=function(Qa,cb){if(!this.DFb)return this.ffg||
aa.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;var lb=this.kta(Ja.Range.hd(1,1));Qa=this.DFb.parseFormula(excelOnlineCalc.parse.parseLocals(1,lb.range),Qa);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(Qa))return aa.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(Qa,cb,this.Pr.config.localeInfo)}catch(Ha){return aa.ULS.sendTraceTag(537170052,
0,10,"CalcManager.ExtractLetVariables - exception: {0}",Ha.message),null}};m.prototype.extractReferences=function(Qa,cb,lb,Ha){if(!cb)return aa.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!lb)return aa.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;var $b=this.kRe(Qa);if(!$b)return aa.ULS.sendTraceTag(537170049,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),null;try{return this.P7g($b,
cb,lb,Qa,Ha)}catch(Jb){return aa.ULS.sendTraceTag(537170048,0,10,"CalcManager.ExtractReferences - exception: {0}",Jb.message),null}};m.prototype.cXh=function(Qa,cb,lb,Ha){if(!Qa)return aa.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!cb||0>=cb.length)return aa.ULS.sendTraceTag(537170018,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;Qa=this.kta(Qa);if(!this.Pr||!Qa)return null;
var $b=this.Iub(Qa).returnValue;if(!$b||$b.Q5a)return null;lb=excelOnline.utils.getCharIndexInTextFromPoint(lb,Ha,Ia.EwaSettings.ma(597));return 0>lb?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.Pr.config,lb,cb,Qa)};m.prototype.ESg=function(Qa,cb,lb,Ha){var $b=this;if(!Qa)return aa.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),null;var Jb=null;return this.evalFormula(cb).then(function(kc){var uc=$b.Pr.plh(kc,lb),hd=uc.returnValue;
8!==uc.kind||hd.length&&hd!==Cb.CalcHelper.unknownError?kc=0:(aa.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),kc=excelOnlineCalc.calc.getEvalFailureReason(kc),void 0!==kc&&null!==kc||aa.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),kc=1);return Jb=Ha?new Eb.a(hd,Ha.start,Ha.end,kc):new Eb.a(hd,-1,-1,kc)},function(kc){aa.ULS.sendTraceTag(537170014,0,10,"EvalSession.GetPartialResultValueForFormula - exception: {0}",
kc);return Promise.resolve(Jb)})};m.prototype.getSubExpressionSpan=function(Qa){return this.Pr&&Qa?excelOnlineCalc.runtime.getSubExpressionSpan(Qa):null};m.prototype.getFormulaSubExpressionObject=function(Qa,cb,lb){return this.Pr&&Qa&&cb&&lb?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.Pr.config,cb,lb,this.kta(Qa)):null};m.prototype.fXh=function(Qa,cb,lb){return this.Pr&&Qa&&cb?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.Pr.config,cb,lb,this.kta(Qa)):null};m.prototype.dXh=
function(Qa,cb,lb){return this.Pr&&Qa&&cb?excelOnlineCalc.runtime.getSubExpressionSubspans(this.Pr.config.localeInfo,cb,lb):null};m.prototype.pQh=function(){return this.Pr?this.Pr.config.localeInfo.listSeparator:null};m.prototype.isFormulaSubExpressionVolatile=function(Qa){return this.Pr?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.Pr.config.localeInfo,Qa):!1};m.prototype.kta=function(Qa,cb){cb=void 0===cb?!0:cb;return Qa&&this.Pr?this.Pr.o9g(this.Pr.bah(),Qa.top-1,Qa.left-1,cb):null};
m.prototype.Mgi=function(Qa,cb){Qa=this.xbc(Qa);if(void 0===Qa||null===Qa)return null;Qa=this.tF.createFormat(Qa.FormatString,Qa.Builtin);if(!excelOnlineCalc.util.isSuccess(Qa))return null;cb=this.tF.parseEdit(cb,Qa.value);return excelOnlineCalc.util.isSuccess(cb)?cb.value.kind===qd.a.formula:null};m.prototype.vbc=function(Qa){if(null==this.tF)return Object(sb.a)("Number formatter is null");if(null==this.instantaneousSupportInformationManager)return Object(sb.a)("Instantaneous manager is null");if(this.$xd.has(Qa))return Object(sb.d)(this.$xd.get(Qa));
if("number"===typeof Qa){var cb=this.xbc(Qa);if(null==cb)return Object(sb.a)("Invalid ifmt="+Qa);var lb=cb.FormatString;cb=cb.Builtin}else lb=Qa,cb=!1;lb=this.tF.createFormat(lb,cb);return excelOnlineCalc.util.isSuccess(lb)?(this.$xd.set(Qa,lb.value),Object(sb.d)(lb.value)):Object(sb.a)("Could not create number format")};m.prototype.getWorksheetFuncId=function(Qa){return this.localeInfo.getWorksheetFuncId(Qa)};m.prototype.P7g=function(Qa,cb,lb,Ha,$b){for(var Jb={Items:[]},kc=0;kc<Qa.length;kc++){var uc=
Qa[kc],hd={};hd.Start=uc.span.start;hd.End=uc.span.end;if($b||uc.kind!==Rb.a.func)if($b||uc.kind!==Rb.a.Wqi){if(this.Igh(uc,cb,lb)){var ma=new u,jb=this.ZTh(uc,cb,ma,Ha);if(Ia.EwaSettings.ma(597)){var Zb=this.gQh(uc),Ub=this.fQh(uc);if(jb||Ub&&0<=Zb)hd={Span:hd,LetNumber:Zb,LetName:Ub,Range:jb},hd.IsRangeRef=ma.Vwa,hd.IsAbsoluteFirstRow=ma.YZ,hd.IsAbsoluteFirstColumn=ma.XZ,hd.IsAbsoluteSecondRow=ma.c5,hd.IsAbsoluteSecondColumn=ma.b5,hd.IsStructRef=uc.kind===Rb.a.zTd,Jb.Items.push(hd)}else jb&&(hd=
{Span:hd,Range:jb},hd.IsRangeRef=ma.Vwa,hd.IsAbsoluteFirstRow=ma.YZ,hd.IsAbsoluteFirstColumn=ma.XZ,hd.IsAbsoluteSecondRow=ma.c5,hd.IsAbsoluteSecondColumn=ma.b5,hd.IsStructRef=uc.kind===Rb.a.zTd,Jb.Items.push(hd))}}else uc=uc.ref.value.oper.kind,Jb.Items.push({Span:hd,IsString:2===uc,IsBoolean:4===uc,IsNumber:1===uc});else hd.End=uc.span.start+uc.ref.name.length,uc={Span:hd,IsFunction:!0},uc.FunctionId=this.getWorksheetFuncId(Ha.substring(hd.Start,hd.End)),Jb.Items.push(uc)}Jb.Items.sort(function(Qc,
kd){return Qc.Span.Start-kd.Span.Start});return Jb};m.prototype.gQh=function(Qa){return Qa.kind===Rb.a.zjf?Qa.ref.number:-1};m.prototype.fQh=function(Qa){return Qa.kind===Rb.a.zjf?Qa.ref.name:null};m.prototype.ZTh=function(Qa,cb,lb,Ha){if(Qa.kind===Rb.a.range)return lb.Vwa=!0,this.rBe(Qa,cb,lb,Ha);if(Qa.kind===Rb.a.namedRange){lb=Qa.ref;(Qa=this.$.Hb.getItemByName(lb.name))||(Qa=this.$.Hb.getItemByName(cb+"!"+lb.name));if(!(Qa&&Qa.sheetName&&Qa.usedRange&&tb.a.equals(Qa.sheetName,cb,!0)))return null;
cb=2===Qa.type?db.a(Qa):Qa.usedRange;return Nb.m(cb,Qa)}if(Qa.kind===Rb.a.zTd){var $b=Qa.ref,Jb;$b.name?(Jb=this.$.Hb.getItemByName($b.name))||(Jb=this.$.Hb.getItemByName(cb+"!"+$b.name)):Jb=this.gridView.Nb.rj(this.gridView.ha.ta.activeCell);if(!(Jb&&Jb.sheetName&&Jb.usedRange&&tb.a.equals(Jb.sheetName,cb,!0)))return null;lb.Vwa=!1;return this.rBe(Qa,cb,lb,Ha)}return null};m.prototype.rBe=function(Qa,cb,lb,Ha){Qa=Qa.ref;if(Qa.type){if(Qa.type===yc.a.column){var $b=Qa.startIndex;Qa=Qa.endIndex;lb.XZ=
$b.kind===bc.a.abs;lb.b5=Qa.kind===bc.a.abs;return this.createRange(0,$b.index,Y.a.Hh,Qa.index,cb)}if(Qa.type===yc.a.row)return $b=Qa.endIndex,lb.YZ=Qa.startIndex.kind===bc.a.abs,lb.c5=$b.kind===bc.a.abs,this.createRange(Qa.startIndex.index,0,Qa.endIndex.index,Y.a.Rh,cb);if(Qa.type===yc.a.cell){$b=Qa.row;var Jb=Qa.col;lb.YZ=lb.c5=$b.kind===bc.a.abs;lb.XZ=lb.b5=Jb.kind===bc.a.abs;return this.O1b(Qa.span.end,Ha)&&(lb=Ja.Range.hd($b.index+1,Jb.index+1),lb=this.gridView.Nb.T1e(lb))?Nb.n(lb,cb):this.createRange($b.index,
Jb.index,$b.index,Jb.index,cb)}if(Qa.type===yc.a.range){$b=Qa.top;Jb=Qa.left;Ha=Qa.bottom;Qa=Qa.right;var kc=Math.min($b.index,Ha.index),uc=Math.min(Jb.index,Qa.index),hd=Math.max($b.index,Ha.index),ma=Math.max(Jb.index,Qa.index);lb.YZ=$b.kind===bc.a.abs;lb.c5=Ha.kind===bc.a.abs;lb.XZ=Jb.kind===bc.a.abs;lb.b5=Qa.kind===bc.a.abs;return this.createRange(kc,uc,hd,ma,cb)}aa.ULS.sendTraceTag(537170010,0,10,"CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '{0}'",Qa.type);return null}aa.ULS.sendTraceTag(537170011,
0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null};m.prototype.O1b=function(Qa,cb){return cb.length>=Qa&&0<Qa&&cb.charAt(Qa-1)===x.IGf};m.prototype.KSg=function(Qa,cb,lb){this.Hl&&this.Hl.OSg(Qa,cb,lb)};m.prototype.xbc=function(Qa){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.dya&&this.instantaneousSupportInformationManager.dya[Qa]&&this.tF?this.instantaneousSupportInformationManager.dya[Qa]:null};m.prototype.toXLNumber=
function(Qa){if(!this.tF)return null;Qa=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,this.tF,Qa);return excelOnlineCalc.util.isSuccess(Qa)?Qa.value:null};m.prototype.VQj=function(Qa,cb){if(Qa){Qa=Gl(Qa);for(var lb=Qa.next();!lb.done;lb=Qa.next())if(lb=lb.value,lb.ref.type&&lb.ref.type===yc.a.cell){var Ha=lb.ref;m.wYi(Ha,cb)&&(Ha.span.end+=1,lb.span.end+=1)}}};m.prototype.createRange=function(Qa,cb,lb,Ha,$b){var Jb={};Jb.FirstRow=Qa;Jb.FirstColumn=cb;Jb.LastRow=lb;Jb.LastColumn=Ha;Jb.SheetName=
$b;return Jb};m.prototype.Igh=function(Qa,cb,lb){var Ha=Qa.ref.qualifier;if(!Ha)return!0;switch(Qa.ref.qualifier.type){case h.sheet:return Qa=Ha.document,tb.a.equals(Ha.sheet,cb,!0)&&(!Qa||tb.a.equals(Qa.document,lb,!0));case h.sheetRange:return cb=this.$.xa.getItemByName(cb),lb=this.$.xa.getItemByName(Ha.sheet1),Ha=this.$.xa.getItemByName(Ha.sheet2),!!cb&&!!lb&&!!Ha&&(lb.index<=cb.index&&cb.index<=Ha.index||Ha.index<=cb.index&&cb.index<=lb.index);case h.document:return tb.a.equals(Ha.document,lb,
!0);case h.A6h:return Ha=Ha.name,tb.a.equals(Ha,cb,!0)||tb.a.equals(Ha,lb,!0);default:return aa.ULS.sendTraceTag(537170009,0,10,"CalcManager.GetQualifierData: Unsupported formula qualifier type '{0}'",Ha.type),!1}};m.prototype.yLj=function(Qa){this.instantaneousSupportInformationManager=Qa;Qa.dya.length&&Qa.ija.length?(this.PFc=new Cb.CalcHelper(this.gridView.$),this.DFb=this.Pr.createParser(),this.Abe=this.Pr.createNumberFormatter(),this.Raf=!0,aa.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),
this.Hl||(aa.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.Hl=new w(this.$))):aa.ULS.sendTraceTag(537170008,0,15,"CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = {0}, functions info count = {1}",Qa.dya.length,Qa.ija.length.toString())};m.prototype.Iub=function(Qa){if(!Qa)return{returnValue:null,emptyCell:!1};var cb=this.getSheetName(Qa.sheet.index);if(!cb)return aa.ULS.sendTraceTag(537169998,
0,50,"CalcManager.GetCellFromBlockCache: No sheet index {0}",Qa.sheet.index),{returnValue:null,emptyCell:!1};var lb=m.convertToRange(Qa);cb=this.gridView.Iub(cb,lb.top,lb.left);return cb?cb.Dgh?{returnValue:cb,emptyCell:!1}:(aa.ULS.sendTraceTag(537169996,0,50,"CalcManager.GetCellFromBlockCache: cell {0} {1} is empty",Qa.range.row,Qa.range.col),{returnValue:null,emptyCell:!0}):(aa.ULS.sendTraceTag(537169997,0,50,"CalcManager.GetCellFromBlockCache: cellProxy is null for cell {0} {1}",Qa.range.row,Qa.range.col),
{returnValue:null,emptyCell:!1})};m.prototype.getSheetName=function(Qa){var cb=this.gridView.$.xa.getItem(Qa);return cb?cb.sheetName:(aa.ULS.sendTraceTag(537169995,0,50,"CalcManager.GetSheetName - no sheet in index {0}",Qa),null)};m.prototype.R8g=function(Qa,cb){var lb={allowUnqualifiedCell:!0,wrapCellReferences:!0};lb.config=this.Pr.config;lb.originGridCell=excelOnlineCalc.util.success(Qa);lb.originSheet=excelOnlineCalc.util.success(cb);return lb};m.prototype.Q8g=function(){var Qa={};Qa.config=this.Pr.config;
Qa.getNameLoc=Object(mb.a)(this.Hl,this.Hl.getNameLoc,"getNameLoc");Qa.getContainingTable=Object(mb.a)(this.Hl,this.Hl.getContainingTable,"getContainingTable");Qa.getStructRefColumn=Object(mb.a)(this.Hl,this.Hl.getStructRefColumn,"getStructRefColumn");Qa.getStructRefSpecialRef=Object(mb.a)(this.Hl,this.Hl.getStructRefSpecialRef,"getStructRefSpecialRef");Qa.getDocumentLoc=Object(mb.a)(this.Hl,this.Hl.getDocumentLoc,"getDocumentLoc");Qa.getSheetIndex=Object(mb.a)(this.Hl,this.Hl.getSheetIndex,"getSheetIndex");
Qa.getSheetName=Object(mb.a)(this.Hl,this.Hl.getSheetName,"getSheetName");Qa.getUserDefinedFuncLoc=Object(mb.a)(this.Hl,this.Hl.getUserDefinedFuncLoc,"getUserDefinedFuncLoc");Qa.getSheetRangeIndexes=Object(mb.a)(this.Hl,this.Hl.getSheetRangeIndexes,"getSheetRangeIndexes");return Qa};m.wYi=function(Qa,cb){return cb.length>Qa.span.end&&cb.charAt(Qa.span.end)===x.IGf};m.convertToRange=function(Qa){return Ja.Range.hd(Qa.range.row+1,Qa.range.col+1)};Ck.Object.defineProperties(m.prototype,{Pr:{configurable:!0,
enumerable:!0,get:function(){return this.PFc}},gridView:{configurable:!0,enumerable:!0,get:function(){return this.fr}},$:{configurable:!0,enumerable:!0,get:function(){return this.xb}},tF:{configurable:!0,enumerable:!0,get:function(){return this.Abe}},localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.Pr?this.Pr.config.localeInfo:null}},config:{configurable:!0,enumerable:!0,get:function(){return this.Pr.config}}});Object(C.a)(m,"CalcManager",null,[603,3]);var Yb=b(37),Hb=b(54),sc=
E.a;Wl(n,sc);n.prototype.create=function(){var Qa=this;if(this.$){aa.ULS.sendTraceTag(537169993,0,50,"CalcManagerFactory.Create: Start loading script");if(Ia.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var cb=54;var lb="Current"}else cb=57,lb="Stable";aa.ULS.sendTraceTag(537169992,0,50,"CalcManagerFactory.Create: Calc {0} JS was loaded",lb);Yb.TaskExtensions.Ba(Hb.a.loadScript(cb,4,this.vb,void 0,void 0,265),function(){aa.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");
var Ha=Qa.$.da.za(266,!1);Ha||(aa.ULS.sendTraceTag(537169990,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),Ha=new m(Qa.$));Qa.Eb(Ha)},this.la,3)}else aa.ULS.sendTraceTag(537169994,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")};n.ka=function(Qa){Qa&&Qa.da&&Qa.da.Ga(265,new n(Qa))};Object(C.a)(n,"CalcManagerFactory",E.a,[]);var zb=b(7),vc=b(5),ad=b(337);Object(C.a)(l,"MarqueeRangeData",null,[]);Object(C.a)(f,"MarqueeMetadata",
null,[]);var ub=b(144),Za=b(696),wa=b(354),ja=b(1084),Ua=b(1183),bb="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");e.prototype.nL=function(Qa,cb){this.fii&&Qa.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");if(this.ZTd||Qa.IH)return!1;var lb=void 0===cb||null===cb?Qa.text:cb;if(this.calcManager&&1<lb.length&&la.e(lb)){var Ha=this.Hvb(),
$b=this.Z_e(),Jb=this.Rc.workbookContext.WorkbookFileName,kc=!1,uc=.01>Math.random()?Object(Da.a)(ub.a,this.Rc.Pb.Gc("LoadingUIShown","ColoredReferencesManager")):null;try{var hd=this.calcManager.extractReferences(lb,$b,Jb,!this.uaf);if(!hd)return aa.ULS.sendTraceTag(524039689,0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;$b=[];Jb=[];for(var ma=[],jb=[],Zb=0,Ub=0,Qc=new za.a(!1),kd="",xb=Gl(hd.Items),bd=xb.next();!bd.done;bd=xb.next()){var Qd=
bd.value;kc=Qd.IsStructRef||kc;if(Qd.IsBoolean||Qd.IsNumber||Qd.IsString){var zd=Qd.IsBoolean?"rgba(0, 0, 255, 1)":Qd.IsNumber?"rgba(9, 134, 88, 1)":"rgba(163, 21, 21, 1)";this.wY(Jb,lb,Zb,Qd.Span.Start,null);this.wY(Jb,lb,Qd.Span.Start,Qd.Span.End,zd);Zb=Qd.Span.End}else if(Ia.EwaSettings.ma(597)){if(Qd.Range||Qd.LetName&&0<=Qd.LetNumber){hd=null;if(Qd.Range){var Jd=Nb.D(Qd.Range);hd=this.MJa(Jd,Qc,1);$b.push(new wa.a(Jd,Ha))}else Qd.LetName&&0<=Qd.LetNumber&&(hd=kd=this.IJh(Qd.LetName,Qd.LetNumber,
Qc,kd),Ub!==Qc.count&&Qa.colors.add(Qd.Span.Start+"-"+Qd.Span.End,bb[(Qc.count-1)%bb.length]));this.wY(Jb,lb,Zb,Qd.Span.Start,null);this.wY(Jb,lb,Qd.Span.Start,Qd.Span.End,hd);Zb=Qd.Span.End;ma.push(Qd.Span);var gc=Jb.length-1;jb.push(new f(gc,Jb[gc].text,ba(Qd)));Ub=Qc.count}}else if(Qd.Range){var Hc=Nb.D(Qd.Range),Tc=this.MJa(Hc,Qc,1);this.wY(Jb,lb,Zb,Qd.Span.Start,null);this.wY(Jb,lb,Qd.Span.Start,Qd.Span.End,Tc);$b.push(new wa.a(Hc,Ha));Zb=Qd.Span.End;ma.push(Qd.Span);var Md=Jb.length-1;jb.push(new f(Md,
Jb[Md].text,ba(Qd)))}}this.wY(Jb,lb,Zb,lb.length,null);this.j_f(Qa,Jb,!!cb);var Xc=Qa.textBox.text;if(!tb.a.equals(Xc,lb,!1)){aa.ULS.shipAssertTag(38114182,0,!1,"ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",Xc.length,lb.length);var Cd=Qa.textBox.caretPosition;Qa.textBox.text=lb;Qa.textBox.caretPosition=Cd;return!0}this.aLa($b,Qc,jb);Ia.EwaSettings.ma(597)&&
0<$b.length&&aa.ULS.sendTraceTag(524039688,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");Ia.EwaSettings.ma(597)&&0<Qa.colors.count&&aa.ULS.sendTraceTag(524039687,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.cka=!0}finally{uc&&uc.OAa(function(){kc&&aa.ULS.sendTraceTag(524039686,0,50,"ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in {0} ms",uc.Bc)})}}else return this.aLa(null,
null),this.cka&&(this.cka=!1,Ha=Qa.textBox.caretPosition,Qa.textBox.setPlainText(lb),Qa.textBox.caretPosition=Math.min(Ha,lb.length),cb)?!0:!1};e.prototype.TWd=function(Qa,cb,lb){if(this.ZTd||Qa.IH)return!1;var Ha=isNullOrUndefined(cb)?Qa.text:cb,$b=[],Jb=new za.a(!1);if(1<Ha.length){var kc=[],uc=[],hd=[],ma=0;if(Object(ja.b)(lb)){var jb=this.Hvb();lb=Gl(lb.formulaHighlights);for(var Zb=lb.next();!Zb.done;Zb=lb.next()){Zb=Zb.value;this.wY(kc,Ha,ma,Zb.span.start,null);switch(Zb.kind){case 0:case 1:case 2:ma=
Nb.B(Zb.rangeInfo.sharedRange);if(isNullOrUndefined(ma)){aa.ULS.sendTraceTag(521211937,0,10,"ColoredReferencesManager.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:{0},",Zb.kind.toString());this.wY(kc,Ha,Zb.span.start,Zb.span.end,null);break}var Ub=this.MJa(ma,Jb,1);this.wY(kc,Ha,Zb.span.start,Zb.span.end,Ub);$b.push(new wa.a(ma,jb));uc.push({Start:Zb.span.start,End:Zb.span.end});ma=kc.length-1;hd.push(new f(ma,kc[ma].text,V(Zb)));break;case 3:this.wY(kc,
Ha,Zb.span.start,Zb.span.end,null,"rgba(229, 229, 229, 1)")}ma=Zb.span.end}}this.wY(kc,Ha,ma,Ha.length);this.j_f(Qa,kc,!!cb);cb=Qa.textBox.text;if(!tb.a.equals(cb,Ha,!1))return aa.ULS.shipAssertTag(521211936,0,!1,"ColoredReferencesManager.UpdateFormulaHighlights: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",cb.length,Ha.length),cb=Qa.textBox.caretPosition,Qa.textBox.text=Ha,Qa.textBox.caretPosition=cb,!0;
this.aLa($b,Jb,hd);return this.cka=!0}this.aLa(null,null);return this.cka&&(this.cka=!1,$b=Qa.textBox.caretPosition,Qa.textBox.setPlainText(Ha),Qa.textBox.caretPosition=Math.min($b,Ha.length),cb)?!0:!1};e.prototype.Spf=function(Qa,cb,lb){if(!Qa||!cb||!lb)return aa.ULS.shipAssertTag(524039685,0,!!Qa,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),aa.ULS.shipAssertTag(524039684,0,!!cb,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),aa.ULS.shipAssertTag(524039683,
0,!!lb,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;var Ha=Object(Da.a)(f,cb.metadata);if(!Ha)return aa.ULS.shipAssertTag(524039682,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var $b=Ha.GGj,Jb=Ha.V7f,kc=this.gridView.Nb.Sbf(lb)?lb.Hac(Ha.XZ,Ha.YZ):lb.Z3a(Ha.XZ,Ha.YZ,Ha.b5,Ha.c5);if(!kc)return aa.ULS.shipAssertTag(524039681,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;var uc=Jb.indexOf("!");-1!==uc&&(kc=Jb.substring(0,
uc+1)+kc);if(!Qa.textBox.changeTextInExistingTextPart($b,Jb,kc))return aa.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;Ha.V7f=kc;$b=!0;for(Jb=1;4>=Jb;Jb++)(kc=va.g(this.Rc).Db.yw(3,Jb,cb.B$))?(kc.range=lb,kc.metadata=Ha):(aa.ULS.shipAssertTag(524039680,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),$b=!1);this.gridView.Db.update(!1,!1);this.gridView.Bj&&(this.gridView.tc.textBox.text=Qa.text);this.gridView.tc.IGb(new ad.a({Hyb:!0}));
return $b};e.prototype.jii=function(Qa){if(3!==Qa.tr)return aa.ULS.shipAssertTag(524039651,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;Qa=Object(Da.a)(f,Qa.metadata);return Qa?Qa.Vwa&&!Qa.nhc:(aa.ULS.shipAssertTag(524039650,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)};e.prototype.Kdb=function(Qa,cb){aa.ULS.sendTraceTag(524039649,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+(cb?"suspending":
"resuming")+" colored references");cb&&this.cka&&(this.cka=!1,this.aLa(null,null),Qa.textBox.yXg());this.ZTd=cb};e.prototype.dispose=function(){this.gridView&&this.gridView.pc&&this.gridView.pc.Um(this.LDb)};e.prototype.v5h=function(Qa){var cb=this.formulaAssistanceTelemetryManager;cb||this.jmf||(this.jmf=!0,aa.ULS.sendTraceTag(521211935,0,50,"ColoredReferencesManager.highlightPreviewRanges: Failed to log highlightPreviewRanges measurement, FormulaAssistanceTelemetryManager unavailable"));null===
cb||void 0===cb?void 0:cb.sX(["highlightPreviewRanges"]);this.vba?this.x5h(Qa):this.w5h(Qa);null===cb||void 0===cb?void 0:cb.uQ(["highlightPreviewRanges"],!0)};e.prototype.x5h=function(Qa){var cb=this.formulaAssistanceManager.Xdd(Qa,Ua.a);if(!isNullOrUndefined(cb)){var lb=this.Hvb(),Ha=[],$b=new za.a(!1),Jb=[];cb=Gl(cb.formulaHighlights);for(var kc=cb.next();!kc.done;kc=cb.next()){kc=kc.value;var uc=kc.kind;if(0===uc||2===uc||1===uc)uc=Nb.B(kc.rangeInfo.sharedRange),Object(ja.b)(uc)&&(Ha.push(new wa.a(uc,
lb)),this.MJa(uc,$b,1),Jb.push(new f(kc.span.start,Qa.substring(kc.span.start,kc.span.end),V(kc),!0)))}this.aLa(Ha,$b,Jb)}};e.prototype.w5h=function(Qa){var cb=this.Hvb(),lb=this.Z_e(),Ha=this.Rc.workbookContext.WorkbookFileName,$b=[],Jb=new za.a(!1),kc=[];if(lb=this.calcManager.extractReferences(Qa,lb,Ha,!this.uaf)){lb=Gl(lb.Items);for(Ha=lb.next();!Ha.done;Ha=lb.next())if(Ha=Ha.value,Ha.Range){var uc=Nb.D(Ha.Range);$b.push(new wa.a(uc,cb));this.MJa(uc,Jb,1);kc.push(new f(Ha.Span.Start,Qa.substring(Ha.Span.Start,
Ha.Span.End),ba(Ha),!0))}this.aLa($b,Jb,kc)}};e.prototype.MJa=function(Qa,cb,lb){var Ha=cb.getItem(Qa.toString());Ha||(Ha=bb[cb.count%bb.length],cb.add(Qa.toString(),Ha));return String.format(Ha,lb)};e.prototype.IJh=function(Qa,cb,lb,Ha){Qa="["+Qa+", "+cb+"]";cb=lb.getItem(Qa);cb||(cb=lb.count%bb.length,cb=bb[cb],Ha===String.format(cb,1)&&(lb.add("skip-"+Qa,cb),cb=lb.count%bb.length,cb=bb[cb]),lb.add(Qa,cb));return String.format(cb,1)};e.prototype.wY=function(Qa,cb,lb,Ha,$b,Jb){$b=void 0===$b?null:
$b;Jb=void 0===Jb?null:Jb;aa.ULS.shipAssertTag(524039648,0,lb<=Ha,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");lb<Ha&&(cb=cb.substring(lb,Ha),Qa.push(Object(zb.a)(new Za.a,{text:cb,color:$b,backgroundColor:Jb})))};e.prototype.aLa=function(Qa,cb,lb){var Ha=this;lb=void 0===lb?null:lb;Qa&&Qa.length?(aa.ULS.sendTraceTag(524039647,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+Qa.length),Qa.reverse(),lb.reverse(),this.gridView.Db.Av(Qa,
[3],!0,function($b,Jb){if($b&&$b.range&&Jb){aa.ULS.shipAssertTag(524039643,0,cb.yb($b.range.toString()),"ColoredReferencesManager.HighlightRanges: The range '{0}' doesn't exist in the range to color dictionary",$b.range.toString());var kc=Ha.MJa($b.range,cb,.1),uc=Ha.MJa($b.range,cb,1);Ha.Rc.frame&&Ha.Rc.frame.yH&&Ha.Rc.frame.yH.Aka||(Jb.style.background=kc);Jb.style.borderColor=uc;lb&&(Jb.setAttribute(vc.a.Ixb,$b.B$.toString()),$b.metadata=lb[$b.B$])}else aa.ULS.shipAssertTag(524039646,0,!!$b,"ColoredReferencesManager.HighlightRanges: state is null"),
aa.ULS.shipAssertTag(524039645,0,!!$b.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),aa.ULS.shipAssertTag(524039644,0,!!Jb,"ColoredReferencesManager.HighlightRanges: div is null")})):(Qa=this.Rc.Pb.Gc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.Db.Oh([3]),this.gridView.Db.sKb(new wa.a(null,this.Hvb()),[3]),Qa.stop())};e.prototype.j_f=function(Qa,cb,lb){var Ha=Qa.textBox;Ha.aK=!0;var $b=Ha.selection,Jb=$b.index;$b=Jb+$b.length;Ha.setTextFromTextParts(cb);cb=
Ha.text.length;Ha.selectRange(Math.min(Jb,cb),Math.min($b,cb));lb&&Qa.IGb(new ad.a);Ha.aK=!1};e.prototype.Hvb=function(){return this.Y_e().sheetId};e.prototype.Z_e=function(){return this.Y_e().sheetName};e.prototype.Y_e=function(){return this.gridView.wt&&this.gridView.wt.AK?this.gridView.wt.AK:this.Rc.qa};Ck.Object.defineProperties(e.prototype,{formulaAssistanceManager:{configurable:!0,enumerable:!0,get:function(){this.P8||(this.P8=this.Rc.da.za(464));return this.P8}},formulaAssistanceTelemetryManager:{configurable:!0,
enumerable:!0,get:function(){this.pDa||(this.pDa=this.Rc.da.za(491));return this.pDa}}});Object(C.a)(e,"ColoredReferencesManager",null,[602,3]);var Xa=E.a;Wl(c,Xa);c.prototype.create=function(){var Qa=this;this.$.da.$a(266,function(cb){cb=Ia.EwaSettings.Gl()?Qa.$.da.za(281)||Qa.$.da.Ga(281,new e(Qa.$,cb)):new e(Qa.$,cb);Qa.Eb(cb)})};c.ka=function(Qa){Qa.da.Ga(282,new c(Qa))};Object(C.a)(c,"ColoredReferencesManagerFactory",E.a,[]);var yb=b(1012),Ib=E.a;Wl(a,Ib);a.prototype.create=function(){var Qa=
this;this.$.da.$a(266,function(cb){cb=Ia.EwaSettings.Gl()?Qa.$.da.za(294)||Qa.$.da.Ga(294,new yb.RelativeAndAbsoluteReferencesManager(cb)):new yb.RelativeAndAbsoluteReferencesManager(cb);Qa.Eb(cb)})};a.ka=function(Qa){Qa.da.Ga(295,new a(Qa))};Object(C.a)(a,"RelativeAndAbsoluteReferencesManagerFactory",E.a,[]);Type.registerNamespace("_Ewa");y.a.Fa(N.ka);y.a.Fa(n.ka);y.a.Fa(c.ka);y.a.Fa(a.ka)},998:function(y,C,b){function a(){}b.d(C,"a",function(){return a});y=b(0);a.abs="Abs";a.rel="Rel";Object(y.a)(a,
"PositionBaseType",null,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.calc.js.map/6ea9c294731edf8b87365bbc8ab25026/EwaDS.calc.js.map