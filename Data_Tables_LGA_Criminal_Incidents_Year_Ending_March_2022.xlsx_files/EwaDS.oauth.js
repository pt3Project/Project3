(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1053:function(y,C,b){function a(ka){var za=this;ka=void 0===ka?null:ka;this.ZS=0;this.fP=null;this.iug=0;var La=xa.a.Ce();this.Dpg=this.Cdh(ka).then(function(Ia){return Ia?za.P7h():(t.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",za.av(),Math.floor(xa.a.Ce()-La)),Ia=ta.a.Rr(),void 0!==Ia&&null!==Ia&&(Ia.set("AuthLibrary",za.av()),Ia=Object.assign(new qa.a,
{durationMs:Math.floor(xa.a.Ce()-La),extendedProperties:Ia}),ha.Health.instance.recordKpiFailure(a.kpiName,"StrategyPickFailed",!1,!0,Ia)),Promise.resolve(1))}).then(function(Ia){return 0!==Ia?Promise.resolve(Ia):za.ari()})}function c(ka){this.mPc=ka;this.vXa="UnsupportedAuthTokenStrategy Reason="+D.a[this.mPc]}function e(){this.Js=null;this.QSb=0;this.Ijb=this.JXa=this.cFc=this.CDa=this.QL=this.Ohe=null;this.Pv=new U.a(null,null);this.xXb=N.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",
!1);this.vXa="SharedAuthTokenStrategy "+(this.xXb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.mY=P.a.qtj;this.Rfe=P.a.ptj;this.k5d=P.a.enableConsoleLogging;this.dng=N.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.Svg=N.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.xXb);this.bra={};this.Opg=new n(1500)}function f(ka,za,La,Ia,Ya,tb,Tb){var va=
Y.call(this,!1,!1,!0)||this;va.z1=null;va.z4d=null;va.mY=ka;va.ztg=La;va.Pv=Ia;va.sxg=Ya;va.CDa=tb;va.Js=document.createElement("iframe");va.Js.id="SharedAuthInteractiveFrame";va.Js.setAttribute("name","SharedAuthInteractiveFrame");va.Js.setAttribute("title","SharedAuthInteractiveFrame");va.Js.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");va.Js.style.border="0";va.Js.style.height="48px";va.Js.style.width="190px";$addHandler(va.Js,"error",Object(ba.a)(va,va.pQi,
"onSharedAuthFrameError"));ka=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",va.mY,za,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",N.AFrameworkApplication.userType);Tb&&(ka+="&vnext=1");va.Js.src=ka;va.Lmg=new Promise(function(la){va.z4d=la});va.A4d=!1;return va}function l(){this.correlationId=this.resolve=null}function n(ka){ka=void 0===ka?0:ka;this.RB=0;this.ykb=!1;this.Fm=new aa.a;this._timeout=ka}function m(){this.reject=this.resolve=null;this.startTime=
0;this.LIf=this.Gse=null}function h(){this.Qie=null;var ka=N.AFrameworkApplication.fa.Va(N.AFrameworkApplication.rea),za=N.AFrameworkApplication.fa.Va(N.AFrameworkApplication.T$f);this.vXa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",ka&&""!==ka?ka:"Unspecified",za&&""!==za?za:"Unspecified")}function x(ka,za,La,Ia,Ya){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=ka;this.scope=za;this.silentLogin=La;this.options=
Ia;this.correlationId=Ya}function u(){}function w(ka){this.Vrg=ka}function v(){}b.r(C);y=b(0);var t=b(15),z=b(901),D=b(1127),A;(function(ka){ka[ka.external=0]="external";ka[ka.msa=1]="msa";ka[ka.aad=2]="aad"})(A||(A={}));Object(y.b)("AuthorityType",A);Object(y.a)(v,"OAuthResult",null,[]);w.prototype.initialize=function(){return Promise.resolve(0)};w.prototype.Hjc=function(){return Promise.resolve(0)};w.prototype.FS=function(){t.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");
return Promise.resolve(Object.assign(new v,{IsSuccess:!0,Token:this.Vrg}))};w.prototype.FAc=function(){return Promise.resolve(Object.assign(new v,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};w.prototype.bzc=function(){return!1};w.prototype.$vb=function(){return"MockAuthTokenStrategy"};Object(y.a)(w,"MockAuthTokenStrategy",null,[933]);var B=b(1151);u.get=function(ka,za,La){if(!La)return ka;
var Ia=0;return Promise.race([ka,new Promise(function(Ya){Ia=window.setTimeout(function(){Ya(za)},La)})]).then(function(Ya){window.clearTimeout(Ia);return Promise.resolve(Ya)}).catch(function(){window.clearTimeout(Ia);return Promise.resolve(za)})};Object(y.a)(u,"PromiseWithTimeout",null,[]);var N=b(4),P=b(940);Object(y.a)(x,"TokenRequestParameters",null,[576]);var Q=b(24),M=b(84);h.prototype.initialize=function(){var ka=this;return new Promise(function(za){M.a.instance.kc("Common.App.WopiIdentity.IWopiIdentity").execute(function(La){ka.Qie=
La;za(0)})})};h.prototype.yi=function(ka){for(var za=!1,La=ka.toLocaleUpperCase(),Ia=Gl(["HTTPS:","API:"]),Ya=Ia.next();!Ya.done;Ya=Ia.next())if(La.startsWith(Ya.value)){za=!0;break}return za||this.ghi(ka)?ka+"/.default":ka};h.prototype.ghi=function(ka){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(ka)};h.prototype.Hjc=function(){return Promise.resolve(0)};h.prototype.FS=function(ka,za,La,Ia,Ya,tb,Tb){if(Q.a.dxa){Ya=P.a.MUj;if(!Ya)return za=Object.assign(new v,
{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(za);if(!Array.contains(Ya,ka))return za=Object.assign(new v,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+ka}),Promise.resolve(za)}ka=this.yi(La);La=new x(La,ka,!Ia,null,N.AFrameworkApplication.userSessionId);return this.Qie.getAccessToken(La,za,Tb).then(function(va){return Object.assign(new v,{IsSuccess:!0,Token:va.accessToken})},function(va){return Object.assign(new v,
{IsSuccess:!1,ErrorCode:va})})};h.prototype.FAc=function(){return Promise.resolve(Object.assign(new v,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};h.prototype.bzc=function(){return!1};h.prototype.$vb=function(){return this.vXa};Object(y.a)(h,"ParentFrameTokenStrategy",null,[933]);var ba=b(82),V=b(1060),aa=b(202);Object(y.a)(m,"PromiseWrapper",null,[]);n.prototype.enqueue=function(ka){var za=
this;return new Promise(function(La,Ia){za.Fm.add(Object.assign(new m,{LIf:ka,resolve:La,reject:Ia}));za.process()})};n.prototype.process=function(){var ka=this;if(this.ykb||this.RB===this.Fm.count)return!1;var za=this.Fm.oa(this.RB++);try{this.ykb=!0,za.LIf().then(function(La){ka.ykb=!1;ka.z1c(za,La,null,!0)}).catch(function(La){ka.ykb=!1;ka.z1c(za,null,La,!1)})}catch(La){this.ykb=!1,this.z1c(za,null,La,!1)}return!0};n.prototype.z1c=function(ka,za,La,Ia){var Ya=this;Ia?0<this._timeout?window.setTimeout(function(){ka.resolve(za);
Ya.process()},this._timeout):(ka.resolve(za),Ya.process()):0<this._timeout?window.setTimeout(function(){ka.reject(La);Ya.process()},this._timeout):(ka.reject(La),Ya.process())};Object(y.a)(n,"PromiseQueue",null,[]);Object(y.a)(l,"ResolveWithCorrelation",null,[]);var E=b(85),G=b(150),I=b(1028),R=b(169),Y=G.a;Wl(f,Y);f.prototype.rxc=function(){var ka={};ka=(ka.promptMessage=this.ztg,ka.errorText=CommonUIStrings.l_InternalError,ka.rtl=N.AFrameworkApplication.isRtl,ka.frameLoaded=!1,ka.createFrame=Object(ba.a)(this,
this.U5g,"createFrame"),ka.resolveDialogStyles=this.z4d,ka);var za={};this.z1=(za.id="SharedAuthConsentDialog",za.bodyControls=ka,za);this.ic=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(ba.a)(this,this.otj,"sharedAuthConsentDialogHandler"),this.z1)};f.prototype.QBc=function(ka,za,La){ka=void 0===ka?!1:ka;za=void 0===za?!1:za;La=void 0===La?5:La;this.z1&&this.z1.bodyControls&&(ka!==Object(E.a)(Object,this.z1.bodyControls).frameLoaded&&(Object(E.a)(Object,this.z1.bodyControls).frameLoaded=
ka),za!==Object(E.a)(Object,this.z1.bodyControls).frameLoadSuccess&&(Object(E.a)(Object,this.z1.bodyControls).frameLoadSuccess=za),La!==this.z1.dialogButtonsOption&&(this.z1.dialogButtonsOption=null,this.ic=La),this.update(this.z1))};f.prototype.Czj=function(ka,za){var La=new I.a(R.a.stj),Ia={};ka=(Ia.signInLabel=CommonUIStrings.l_SignIn,Ia.cancelLabel=CommonUIStrings.l_DialogCancel,Ia.rtl=N.AFrameworkApplication.isRtl,Ia.messageCorrelationId=ka,Ia.dialogStyles=za,Ia);La.Values=ka;this.Pv.ZQa(La,
this.Js.contentWindow,this.mY)};f.prototype.YTe=function(){this.QBc(!0,!1,6)};f.prototype.pQi=function(){this.YTe()};f.prototype.U5g=function(){return this.Js};f.prototype.otj=function(ka){0===ka&&(this.sxg.reject(Object.assign(new v,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.CDa(null))};Ck.Object.defineProperties(f.prototype,{f0f:{configurable:!0,enumerable:!0,get:function(){return this.Js}},peh:{configurable:!0,enumerable:!0,get:function(){var ka=
this;return this.Lmg.then(function(za){ka.A4d=!0;return za})}},qeh:{configurable:!0,enumerable:!0,get:function(){return this.A4d}}});Object(y.a)(f,"SharedAuthConsentDialog",G.a,[953]);var U=b(1318),ha=b(98),ta=b(136),xa=b(39),oa=b(176),qa=b(190);e.prototype.$vb=function(){return this.vXa};e.prototype.initialize=function(){var ka=b(1053).OAuthManager;if("loadFrame"in this.bra)return this.bra.loadFrame.Gse;if(!this.mY)return ha.Health.instance.recordKpiFailure(ka.kpiName,"SharedAuthFrameOriginNotSet",
!1,!1,null),t.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);ka=this.Lyc("loadFrame");this.QSb=xa.a.Ce();var za=this.mY+this.Rfe+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+N.AFrameworkApplication.userSessionId+"&WacUserType="+N.AFrameworkApplication.userType;this.xXb&&(za+="&vnext=1");this.Js=document.createElement("iframe");this.x9h(this.Js);this.Js.style.cssText="height:0;width:0;display:none;";
this.Js.id="SharedAuthFrame";this.Js.setAttribute("name","SharedAuthFrame");this.Js.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Js.setAttribute("title","SharedAuthFrame");this.Js.src=za;document.body.appendChild(this.Js);za=xa.a.Ce()-this.QSb;t.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",za,this.Js.src);return ka};e.prototype.Hjc=function(ka){this.cFc=ka;var za=new I.a(R.a.i0f);
za.Values=this.gse(ka);ka=this.Lyc("initFrame");this.Pv.ZQa(za,this.Js.contentWindow,this.mY);t.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return ka};e.prototype.FS=function(ka,za,La,Ia,Ya,tb){var Tb=this,va=new I.a(R.a.ttj),la=this.W0e();va.Values=this.n$f(ka,za,La,Ia,Ya,tb,la);ka=this.Lyc(la);Ia&&N.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.Opg.enqueue(function(){return new Promise(function($a){Tb.wLj(tb,
va,$a,la)})}):(this.Pv.ZQa(va,this.Js.contentWindow,this.mY),t.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",za));return ka};e.prototype.wLj=function(ka,za,La,Ia){var Ya=this.bra[Ia];Ya&&(this.JXa=za,this.CDa=Object.assign(new l,{resolve:La,correlationId:Ia}),this.QL=new f(this.mY,this.Rfe,ka,this.Pv,Ya,La,this.xXb),this.QL.rxc())};e.prototype.W0e=function(){return oa.a.create().toString()};e.prototype.n$f=function(ka,za,La,Ia,Ya,tb,Tb){var va=
{};va.appName=ka;va.appId=za;va.target=La;va.withPopup=Ia;va.claims=Ya;va.promptMessage=tb;va.messageCorrelationId=Tb;return va};e.prototype.x9h=function(ka){$addHandler(ka,"load",Object(ba.a)(this,this.rLi,"onIFrameLoaded"));$addHandler(ka,"error",Object(ba.a)(this,this.lnc,"onIFrameError"));this.Pv.tFa(this.mY);this.Pv.jo(R.a.l0f);this.Pv.Tl(R.a.l0f,Object(ba.a)(this,this.JPi,"onScriptLoaded"));this.Pv.jo(R.a.k0f);this.Pv.Tl(R.a.k0f,Object(ba.a)(this,this.IPi,"onScriptInitialized"));this.Pv.jo(R.a.g0f);
this.Pv.Tl(R.a.g0f,Object(ba.a)(this,this.SKi,"onGetTokenResponse"));this.Pv.jo(R.a.m0f);this.Pv.Tl(R.a.m0f,Object(ba.a)(this,this.HMi,"onLoginResponse"));this.Pv.jo(R.a.j0f);this.Pv.Tl(R.a.j0f,Object(ba.a)(this,this.LLi,"onInteractiveFlowReady"));this.Pv.jo(R.a.h0f);this.Pv.Tl(R.a.h0f,Object(ba.a)(this,this.jLi,"onHideDialog"));this.Pv.jo(R.a.e0f);this.Pv.Tl(R.a.e0f,Object(ba.a)(this,this.nGi,"onCloseDialog"))};e.prototype.Lyc=function(ka){var za=new m;za.startTime=xa.a.Ce();var La=new Promise(function(Ia,
Ya){za.resolve=Ia;za.reject=Ya});za.Gse=La;this.bra[ka]=za;return La};e.prototype.rLi=function(){var ka=xa.a.Ce()-this.QSb;t.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",ka)};e.prototype.lnc=function(ka){var za=b(1053).OAuthManager,La=xa.a.Ce()-this.QSb,Ia=Object.assign(new qa.a,{durationMs:La});ha.Health.instance.recordKpiFailure(za.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,Ia);t.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",
La,this.k5d?JSON.stringify(ka):"")};e.prototype.JPi=function(ka){var za=b(1053).OAuthManager,La=this.bra.loadFrame,Ia=xa.a.Ce()-La.startTime,Ya=ka.Values.AuthLibrary.toString();ka=ka.Values.Success.toString();t.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",ka,Ya,Ia);Ya&&(this.vXa="SharedAuthTokenStrategy "+Ya);Ya=Boolean.parse(ka);Ya||(ka=ta.a.Rr(),void 0!==ka&&null!==ka&&(ka.set("AuthLibrary",this.$vb()),Ia=Object.assign(new qa.a,
{durationMs:Ia,extendedProperties:ka}),ha.Health.instance.recordKpiFailure(za.kpiName,"SharedAuthStrategyInitFailed",!1,!0,Ia)));La.resolve(Ya?0:1)};e.prototype.IPi=function(ka){var za=this;if(ka.Values.interactive&&this.JXa&&this.JXa.Values.messageCorrelationId){var La=this.JXa.Values.messageCorrelationId.toString();if(ka.Values.interactive&&this.QL){this.QL.peh.then(function(Ya){za.Pv.ZQa(za.JXa,za.QL.f0f.contentWindow,za.mY);za.QL.Czj(La,Ya);za.QL.QBc(!0,!0);za.JXa=null});return}}ka=this.bra.initFrame;
var Ia=xa.a.Ce()-ka.startTime;t.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",Ia);ka.resolve(0)};e.prototype.SKi=function(ka){if(ka.Values.messageCorrelationId&&ka.Values.messageCorrelationId.toString()){var za=ka.Values.messageCorrelationId.toString(),La=this.bra[za];if(La){var Ia=xa.a.Ce()-La.startTime;t.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",Ia);ka.Values.isSuccess&&ka.Values.isSuccess?La.resolve(ka.Values.response):
La.reject(ka.Values.response);this.C$f(za)}else t.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else t.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};e.prototype.LLi=function(){if(this.QL.qeh)this.QL.YTe();else if(this.cFc&&this.QL){var ka=new I.a(R.a.i0f);ka.Values=this.gse(this.cFc,!0);this.Pv.ZQa(ka,this.QL.f0f.contentWindow,this.mY)}};e.prototype.jLi=
function(){this.QL&&this.QL.hxb()};e.prototype.nGi=function(ka){ka.Values.cancelled&&ka.Values.cancelled&&ka.Values.messageCorrelationId&&this.C$f(ka.Values.messageCorrelationId.toString());this.QL&&this.QL.hide()};e.prototype.gse=function(ka,za){za=void 0===za?!1:za;var La={};La.appIds=this.kHh();La.upn=ka.loginHint;La.authority=ka.authority;La.authorityType=Object(z.a)(A,ka.authorityType);La.tenantId=ka.tenantId;La.correlationId=N.AFrameworkApplication.userSessionId;La.enableConsoleLogging=this.k5d;
La.enablePopupFlash=this.dng;La.skipUpnCheck=this.Svg;La.interactive=za;return La};e.prototype.kHh=function(){var ka=[],za=P.a.fWc,La;for(La in za)Array.add(ka,za[La]);return ka};e.prototype.FAc=function(ka,za,La,Ia,Ya,tb){var Tb=new I.a(R.a.rtj),va=this.W0e();Tb.Values=this.n$f(ka,za,La,Ia,Ya,tb,va);this.Ohe=Tb;ka=this.Lyc(va);t.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",za);this.lxj();return ka};e.prototype.bzc=function(){return!0};e.prototype.lxj=
function(){var ka=this;this.Ijb||(this.Ijb=new V.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Ijb.id=16,this.Ijb.bef=!1,this.Ijb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,function(){t.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");ka.Pv.ZQa(ka.Ohe,ka.Js.contentWindow,ka.mY)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),t.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};
e.prototype.HMi=function(ka){if(ka.Values.messageCorrelationId&&ka.Values.messageCorrelationId.toString()){var za=this.bra[ka.Values.messageCorrelationId.toString()];if(za){var La=xa.a.Ce()-za.startTime;t.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",La);ka.Values.isSuccess&&ka.Values.isSuccess?za.resolve(ka.Values.response):za.reject(ka.Values.response)}else t.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else t.ULS.sendTraceTag(555049439,
3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};e.prototype.C$f=function(ka){this.CDa&&this.CDa.correlationId===ka&&(this.CDa.resolve(null),this.CDa=null)};Object(y.a)(e,"SharedAuthTokenStrategy",null,[933]);c.prototype.initialize=function(){return Promise.resolve(0)};c.prototype.Hjc=function(){return Promise.resolve(0)};c.prototype.FS=function(){return Promise.resolve(Object.assign(new v,{IsSuccess:!1,ErrorCode:D.a[this.mPc],ErrorMessage:"Unable to get a token. Reason: ["+
D.a[this.mPc]+"]"}))};c.prototype.FAc=function(){return Promise.resolve(Object.assign(new v,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};c.prototype.bzc=function(){return!1};c.prototype.$vb=function(){return this.vXa};Object(y.a)(c,"UnsupportedAuthTokenStrategy",null,[933]);var Ea=b(933);b.d(C,"OAuthManager",function(){return a});a.prototype.Ddh=function(){var ka=P.a.rzi;ka&&0<ka.length?
(this.ZS=1,this.fP=new w(ka)):N.AFrameworkApplication.fa.ra("IsO365ConsumerHost")||N.AFrameworkApplication.fa.ra("IsO365CommercialHost")?N.AFrameworkApplication.fa.ra("IsAnonymousUser")?(this.ZS=2,this.fP=new c(this.ZS)):(ka=B.a.getAuthContext().loginHint)&&ka.length?P.a.lxb?(this.ZS=1,this.fP=new h):(this.ZS=1,this.fP=new e):(this.ZS=3,this.fP=new c(this.ZS)):(this.ZS=4,this.fP=new c(this.ZS))};a.prototype.av=function(){return this.fP?this.fP.$vb()||"Unknown":"None"};a.prototype.Cdh=function(ka){var za=
this;ka=void 0===ka?null:ka;t.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var La=xa.a.Ce();return N.AFrameworkApplication.fa.Ydd().then(function(Ia){Ia?(za.Ddh(),ka&&(za.fP=ka),t.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",P.a.clientVersion,P.a.appVersion,P.a.xgh,za.av(),Math.floor(xa.a.Ce()-La))):t.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",
Math.floor(xa.a.Ce()-La));return Promise.resolve(Ia)},function(){t.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(xa.a.Ce()-La));return Promise.resolve(!1)})};a.prototype.P7h=function(){var ka=this;t.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.av());var za=xa.a.Ce();return u.get(this.fP.initialize(),2,P.a.hFd).then(function(La){if(0===La)t.ULS.sendTraceTag(42084353,3E3,
50,"Initialization succeeded for {0} in {1} ms.",ka.av(),Math.floor(xa.a.Ce()-za));else if(1===La){t.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",ka.av(),Math.floor(xa.a.Ce()-za));var Ia=ta.a.Rr();void 0!==Ia&&null!==Ia&&(Ia.set("AuthLibrary",ka.av()),Ia=Object.assign(new qa.a,{durationMs:Math.floor(xa.a.Ce()-za),extendedProperties:Ia}),ha.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,Ia))}else 2===
La&&(t.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",ka.av(),Math.floor(xa.a.Ce()-za)),Ia=ta.a.Rr(),void 0!==Ia&&null!==Ia&&(Ia.set("AuthLibrary",ka.av()),Ia=Object.assign(new qa.a,{durationMs:Math.floor(xa.a.Ce()-za),extendedProperties:Ia}),ha.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,Ia)));return Promise.resolve(La)},function(){t.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",
ka.av(),Math.floor(xa.a.Ce()-za));return Promise.resolve(1)})};a.prototype.ari=function(){var ka=this;t.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.av());var za=xa.a.Ce();return u.get(this.fP.Hjc(B.a.getAuthContext()),2,P.a.hFd).then(function(La){if(0===La)t.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",ka.av(),Math.floor(xa.a.Ce()-za));else if(1===La){t.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",
ka.av(),Math.floor(xa.a.Ce()-za));var Ia=ta.a.Rr();void 0!==Ia&&null!==Ia&&(Ia.set("AuthLibrary",ka.av()),Ia=Object.assign(new qa.a,{durationMs:Math.floor(xa.a.Ce()-za),extendedProperties:Ia}),ha.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadFailed",!1,!0,Ia))}else 2===La&&(t.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",ka.av(),Math.floor(xa.a.Ce()-za)),Ia=ta.a.Rr(),void 0!==Ia&&null!==Ia&&(Ia.set("AuthLibrary",ka.av()),
Ia=Object.assign(new qa.a,{durationMs:Math.floor(xa.a.Ce()-za),extendedProperties:Ia}),ha.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadTimedOut",!1,!0,Ia)));return Promise.resolve(La)},function(){t.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",ka.av(),Math.floor(xa.a.Ce()-za));return Promise.resolve(1)})};a.prototype.FS=function(ka,za,La){return this.DAc(ka,za,!1,null,"",void 0===La?null:La)};a.prototype.o$f=function(ka,
za,La,Ia,Ya){return this.DAc(ka,za,!0,La,Ia,void 0===Ya?null:Ya)};a.prototype.DAc=function(ka,za,La,Ia,Ya,tb,Tb){Tb=void 0===Tb?0:Tb;Tb+=1;t.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",ka,this.IQa(ka,za),this.av(),Tb);var va=ta.a.Rr();void 0!==va&&null!==va&&(va.set("AuthLibrary",this.av()),va.set("AppName",ka),va.set("Target",this.IQa(ka,za)),ha.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",va));if(!P.a.isEnabled){var la;
return this.wtd((la=new v,la.IsSuccess=!1,la.Token=null,la.ErrorCode="NotEnabled",la.ErrorMessage="OAuthManager is disabled.",la),ka)}var $a=P.a.fWc[ka];if(void 0===$a||null===$a){t.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",ka);var Ra;return this.wtd((Ra=new v,Ra.IsSuccess=!1,Ra.Token=null,Ra.ErrorCode="DisallowedApp",Ra.ErrorMessage="Disallowed appName: "+ka,Ra),ka)}var eb=xa.a.Ce(),mb=this;va=this.Dpg.then(function(Sa){return mb.Dci(ka,
$a,za,La,Ia,Ya,tb,Sa)});la=La?0:P.a.hFd;var Pa;Ra=(Pa=new v,Pa.IsSuccess=!1,Pa.Token=null,Pa.ErrorCode="authTokenStrategy_timeout",Pa.ErrorMessage="Auth Strategy timed out after ["+la+"] ms when fetching token",Pa);var Da=this,Ta=this;return u.get(va,Ra,la).then(function(Sa){return Tb<=a.Yxi&&(Sa.ErrorCode===a.C8f||Sa.ErrorCode===a.$Dj)?(t.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Tb,Math.floor(xa.a.Ce()-eb)),Da.DAc(ka,za,La,Ia,Ya,tb,Tb)):Sa.ErrorCode===
a.Ahf&&!La&&(t.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",Tb,a.tKe),a.Bjh&&Da.fP.bzc()&&Da.fP.FAc(ka,$a,za,La,Ia,Ya).then(function(Cb){return Promise.resolve(Da.Zjc(Cb,ka,za,$a,eb))}).catch(function(){var Cb,cc=(Cb=new v,Cb.IsSuccess=!1,Cb.Token=null,Cb.ErrorCode="authTokenStrategy_failure",Cb.ErrorMessage="LoginPopup failed, GetToken could not be called",Cb);return Promise.resolve(Da.Zjc(cc,ka,za,$a,eb))}),a.tKe)?Da.DAc(ka,
za,!0,Ia,Ya,tb,Tb):Promise.resolve(Da.Zjc(Sa,ka,za,$a,eb))}).catch(function(){var Sa,Cb=(Sa=new v,Sa.IsSuccess=!1,Sa.Token=null,Sa.ErrorCode="authTokenStrategy_failure",Sa.ErrorMessage="Auth Strategy failed with an unknown error",Sa);return Promise.resolve(Ta.Zjc(Cb,ka,za,$a,eb))})};a.prototype.Dci=function(ka,za,La,Ia,Ya,tb,Tb,va){var la=this;return 1===va||2===va?this.wtd(Object.assign(new v,{IsSuccess:!1,Token:null,ErrorCode:1===va?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),
ka):this.fP.FS(ka,za,La,Ia,Ya,tb,Tb).then(function($a){return Promise.resolve(la.grf($a,!0,ka))}).catch(function($a){return Promise.resolve(la.grf($a,!1,ka))})};a.prototype.Zjc=function(ka,za,La,Ia,Ya){var tb={};Ya=xa.a.Ce()-Ya;tb.IsSuccess=ka.IsSuccess;tb.ErrorCode=ka.IsSuccess?"Success":ka.ErrorCode||"";tb.ErrorMessage=ka.IsSuccess?"Success":this.IQa(za,ka.ErrorMessage||"");tb.Target=this.IQa(za,La||"");tb.TimeInMS=Math.floor(Ya);tb.AuthLibrary=this.av();tb.AppName=za;tb.AuthorityType=Object(z.a)(A,
B.a.T$b());tb.UserType=this.dZh(B.a.getAuthContext());tb.IsAuthSupportedInSession=D.a[this.ZS];tb.RequestCount=++this.iug;tb.AppId=Ia;t.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(tb));ka.IsSuccess||(La=ta.a.Rr(),void 0!==La&&null!==La&&(La.set("AppName",za),La.set("AuthLibrary",this.av()),La.set("ErrorCode",ka.ErrorCode),La.set("ErrorMessage",this.IQa(za,ka.ErrorMessage)),za=Object.assign(new qa.a,{durationMs:Ya,extendedProperties:La}),ha.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",
!1,!0,za)));return ka};a.prototype.wtd=function(ka,za){t.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",za,this.IQa(za,ka.ErrorMessage));var La=ta.a.Rr();void 0!==La&&null!==La&&(La.set("AppName",za),La.set("AuthLibrary",this.av()),La.set("ErrorCode",ka.ErrorCode),La.set("ErrorMessage",this.IQa(za,ka.ErrorMessage)),za=Object.assign(new qa.a,{extendedProperties:La}),ha.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",
!1,!0,za));return Promise.resolve(ka)};a.prototype.Icf=function(ka){return ka===Ea.a.Nzc};a.prototype.IQa=function(ka,za){return this.Icf(ka)&&za?"REDACTED":za};a.prototype.dZh=function(ka){return N.AFrameworkApplication.fa.ra("IsAnonymousUser")?"anonymous":!ka.loginHint||1>ka.loginHint.length?"empty":-1<ka.loginHint.indexOf("guest#")?"guest":-1<ka.loginHint.indexOf("ext#")?"external":0>ka.upn.indexOf("@")?"no-at":"supported"};a.prototype.C5a=function(){return 1===this.ZS};a.prototype.grf=function(ka,
za,La){var Ia=null,Ya=null,tb=null,Tb=null;ka?ka.ErrorCode||ka.ErrorMessage?(Ya=ka.ErrorCode?ka.ErrorCode:a.vQe,tb=ka.ErrorMessage?ka.ErrorMessage:"No message"):ka.Token?za?Ia=ka.Token:(Ya=a.V7i,tb="A rejected promise returned a token."):(Ya=a.vQe,tb=JSON.stringify(ka)):(Ya=a.SBi,tb="No result came from Auth Token Strategy");ka&&ka.Telemetry&&!this.Icf(La)&&(Tb=ka.Telemetry,t.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Tb)));if(Ya===a.Dzi||Ya===a.NIj)Ya=a.C8f,tb="Auth Library Timed Out";Ya===
a.cMg&&-1<tb.indexOf(a.jyg)&&(Ya=a.Ahf);if(Ya||tb)Ia=null;return Object.assign(new v,{IsSuccess:!!Ia,Token:Ia,ErrorCode:Ya,ErrorMessage:tb,Telemetry:Tb})};Ck.Object.defineProperties(a,{tKe:{configurable:!0,enumerable:!0,get:function(){return N.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}},Bjh:{configurable:!0,enumerable:!0,get:function(){return N.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",
!1)}}});a.NIj="token_renewal_error";a.vQe="Exception";a.SBi="NoResult";a.V7i="RejectToken";a.Dzi="monitor_window_timeout";a.C8f="Timeout";a.$Dj="authTokenStrategy_timeout";a.cMg="login_required";a.jyg="AADSTS50058";a.Ahf="Cookies Disabled";a.kpiName="OAuthManager";a.Yxi=2;Object(y.a)(a,"OAuthManager",null,[833])},1127:function(y,C,b){b.d(C,"a",function(){return a});y=b(0);var a;(function(c){c[c.unknown=0]="unknown";c[c.supported=1]="supported";c[c.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";
c[c.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";c[c.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(y.b)("SupportStatus",a)},1463:function(y,C,b){function a(aa){var E=V.call(this)||this;E.$=aa;E.Tb();return E}function c(aa){this.oAuthManager=aa}function e(){}function f(aa){this.zUb=aa}function l(){}function n(){}b.r(C);y=b(0);var m=b(15),h=b(1053),x=b(1127),u=b(4),w=b(98),v=b(940),t=b(257),z=b(39),D=b(24),A=b(84),B=b(190);n.prototype.fi=function(aa){aa.register(833,"Common.App.OAuth.IOAuthManager").Hc().Oc(function(){return new h.OAuthManager})};
n.prototype.init=function(){var aa=A.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.gMj(aa)};n.prototype.gMj=function(aa){var E=u.AFrameworkApplication.fa.Va("FileSource");if(u.AFrameworkApplication.fa.ra("IsO365ConsumerHost")||u.AFrameworkApplication.fa.ra("IsO365CommercialHost")||"WopiTest"===E){var G=v.a.sDh,I=v.a.authority;if(void 0!==G&&null!==G&&G.length&&void 0!==I&&null!==I&&I.length){var R=x.a[aa.ZS],Y=D.a.uGa,U=aa.av();try{var ha=new Map;void 0!==ha&&null!==ha?(ha.set("SupportStatus",
R),ha.set("Browser",Y),ha.set("AuthStrategy",U)):ha=null}catch(xa){ha=null}w.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",ha);var ta=z.a.Ce();aa.FS("Core",G).then(function(xa){var oa=Math.floor(z.a.Ce()-ta);R=x.a[aa.ZS];Y=D.a.uGa;U=aa.av();m.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',oa,xa.IsSuccess,R,xa.ErrorCode,
E,Y,U);ha&&(ha.set("SupportStatus",R),ha.set("Browser",Y),ha.set("AuthStrategy",U));oa=Object.assign(new B.a,{durationMs:oa,extendedProperties:ha});xa.IsSuccess?w.Health.instance.recordKpiSuccess("WacCorePFT",oa):w.Health.instance.recordKpiFailure("WacCorePFT",xa.ErrorCode,!1,!1,oa)}).catch(function(xa){var oa=Math.floor(z.a.Ce()-ta);oa=Object.assign(new B.a,{durationMs:oa,extendedProperties:ha});w.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+xa.toString(),!1,!1,oa)})}}};n.prototype.dispose=
function(){};n.main=function(){t.a.instance.gj(new n)};Ck.Object.defineProperties(n.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});Object(y.a)(n,"OAuthPackage",null,[4,5]);var N=b(1151);Object(y.a)(l,"LokiTokenResult",null,[]);f.prototype.Ged=function(){var aa=this,E=this.xQh();return E?f.Tod?new Promise(function(G,I){aa.zUb.continueWith(function(){aa.zUb.Ph||aa.zUb.kg?I(Error.create("Error downloading auth library")):aa.zUb.result.FS("Loki",
E).then(function(R){R=u.AFrameworkApplication.fa.ra("ForceLokiFallbackToACLPTokenIsEnabled")?aa.AQh():R.IsSuccess&&R.Token?Object.assign(new l,{isSuccess:!0,token:R.Token,errorMessage:null}):Object.assign(new l,{isSuccess:!1,token:null,errorMessage:JSON.stringify(R)});G(R);return R})})}):Promise.resolve(Object.assign(new l,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new l,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",
N.a.gWe())}))};f.prototype.AQh=function(){var aa=u.AFrameworkApplication.fa.Va("LokiUserDataSignature")||"";return Object.assign(new l,{isSuccess:!0,token:aa,errorMessage:null})};f.prototype.xQh=function(){var aa=null,E=N.a.T$b();2===E?aa=u.AFrameworkApplication.fa.Va("LokiAADAppId"):1===E&&(aa=u.AFrameworkApplication.fa.Va("LokiMSAAppId"));return aa};Ck.Object.defineProperties(f,{Tod:{configurable:!0,enumerable:!0,get:function(){return u.AFrameworkApplication.fa.ra("IsO365CommercialHost")||u.AFrameworkApplication.fa.ra("IsO365ConsumerHost")}}});
Object(y.a)(f,"LokiTokenManager",null,[838]);var P=b(563);e.prototype.init=function(){A.a.instance.resolve("Common.ILokiTokenManager")};e.prototype.dispose=function(){};e.prototype.fi=function(aa){aa.register(f,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").Hc().Oc(function(){return new f(P.a.ar(aa.kc("Common.App.OAuth.IOAuthManager")))})};e.main=function(){t.a.instance.gj(new e)};Ck.Object.defineProperties(e.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});
Object(y.a)(e,"LivePersonaUtilsPackage",null,[4,5]);var Q=b(11);C=b(229);var M=b(7),ba=b(1021);c.prototype.FS=function(aa,E){return this.oAuthManager?this.oAuthManager.FS(aa,E).then(function(G){G.IsSuccess||m.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+G.ErrorMessage+" Error code: "+G.ErrorCode+" App name: "+aa);return Object(M.a)(new ba.a,{IsSuccess:G.IsSuccess,Token:G.Token,ErrorCode:G.ErrorCode,ErrorMessage:G.ErrorMessage})}):(m.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),
Promise.resolve(Object(M.a)(new ba.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};c.prototype.C5a=function(){return this.oAuthManager?this.oAuthManager.C5a():null};Object(y.a)(c,"OAuthManagerWrapper",null,[485]);var V=C.a;Wl(a,V);a.prototype.create=function(){this.Eb(this.$.da.za(349)||new c(A.a.instance.resolve("Common.App.OAuth.IOAuthManager")))};a.ka=function(aa){aa.da.Ga(350,new a(aa))};Object(y.a)(a,"OAuthManagerFactory",
C.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Type.registerNamespace("Common.App.OAuth");n.main();Type.registerNamespace("Common.App.LivePersonaUtils");e.main();(function(){Q.a.Fa(function(aa){a.ka(aa)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.oauth.js.map/11bcf2e2da637d4e92fcc78fedd4e495/EwaDS.oauth.js.map